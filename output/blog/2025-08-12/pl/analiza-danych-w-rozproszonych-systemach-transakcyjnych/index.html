<!doctype html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Analiza danych w rozproszonych systemach transakcyjnych</title>
    <meta property="og:title" content="Analiza danych w rozproszonych systemach transakcyjnych" />
    <meta name="twitter:title" content="Analiza danych w rozproszonych systemach transakcyjnych" >

    <meta name="description" content="Czy TwÃ³j system transakcyjny pada pod naporem raportÃ³w? Szukasz sposobu na zbudowanie jednolitego ÅºrÃ³dÅ‚a danych dla rozproszonego systemu? Dowiedz siÄ™, w jaki sposÃ³b zaczÄ…Ä‡ zbudowaÄ‡ wydajny magazyn danych analitycznych oraz jak uniknÄ…Ä‡ podstawowych.">
    <meta property="og:description" content="Czy TwÃ³j system transakcyjny pada pod naporem raportÃ³w? Szukasz sposobu na zbudowanie jednolitego ÅºrÃ³dÅ‚a danych dla rozproszonego systemu? Dowiedz siÄ™, w jaki sposÃ³b zaczÄ…Ä‡ zbudowaÄ‡ wydajny magazyn danych analitycznych oraz jak uniknÄ…Ä‡ podstawowych.">
    <meta name="twitter:description" content="Czy TwÃ³j system transakcyjny pada pod naporem raportÃ³w? Szukasz sposobu na zbudowanie jednolitego ÅºrÃ³dÅ‚a danych dla rozproszonego systemu? Dowiedz siÄ™, w jaki sposÃ³b zaczÄ…Ä‡ zbudowaÄ‡ wydajny magazyn danych analitycznych oraz jak uniknÄ…Ä‡ podstawowych.">

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://norbert.tech/blog/2025-08-12/pl/analiza-danych-w-rozproszonych-systemach-transakcyjnych" />
                <meta property="og:image" content="https://norbert.tech/assets/images/blog/analytics-in-transactional-distributed-systems/analytics_01-b27f8a842f645a9c7d9901f3fd11fde8.jpg" />
                    
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://norbert.tech/blog/2025-08-12/pl/analiza-danych-w-rozproszonych-systemach-transakcyjnych" />
    <meta name="twitter:image" content="https://norbert.tech/assets/images/avatar-8f3c52c37f20d07c5e1631e1512bdeca.jpeg">
    <meta name="twitter:site" content="@norbert_tech" />
    <meta name="twitter:creator" content="@norbert_tech" />

    <link rel="apple-touch-icon" sizes="180x180" href="https://norbert.tech/assets/images/favicons/apple-touch-icon-9cae7ee880b4fe0bd755d300e1bca71e.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://norbert.tech/assets/images/favicons/favicon-32x32-b7a4ad4b584ab95534144e071f0e8587.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://norbert.tech/assets/images/favicons/favicon-16x16-154ca21abc06ae116c8d7ffc5713c000.png">
    <link rel="shortcut icon" href="https://norbert.tech/assets/images/favicons/favicon-db409885df78dea389e6d0b036da382c.ico">

            <style>
            @import url('https://fonts.googleapis.com/css2?family=Cabin:ital,wght@0,400..700;1,400..700&display=swap');
        </style>
        <link rel="stylesheet" href="https://norbert.tech/assets/styles/app-e24f407580be48180186fb40114b24be.css">
    
            
<script type="importmap">
{
    "imports": {
        "app": "https://norbert.tech/assets/app-930adf3462cf9ab60908eb1b74cf7ca7.js",
        "@oddbird/popover-polyfill": "https://norbert.tech/assets/vendor/@oddbird/popover-polyfill/popover-polyfill.index-7979d53637476aa204f709644aed2c19.js",
        "https://norbert.tech/assets/bootstrap.js": "https://norbert.tech/assets/bootstrap-d78d7e12c819dedf89372fb4824c072d.js",
        "htmx.org": "https://norbert.tech/assets/vendor/htmx.org/htmx.org.index-023ae86a082913526422a6063298f898.js",
        "iconify-icon": "https://norbert.tech/assets/vendor/iconify-icon/iconify-icon.index-8a41e423576dc2d752509fd455f508c1.js",
        "@symfony/stimulus-bundle": "https://norbert.tech/assets/@symfony/stimulus-bundle/loader-9311b8ea36bad0f6168e687b4d6dee73.js",
        "@hotwired/stimulus": "https://norbert.tech/assets/vendor/@hotwired/stimulus/stimulus.index-304681764684182e6662e0931532ed91.js",
        "https://norbert.tech/assets/@symfony/stimulus-bundle/controllers.js": "https://norbert.tech/assets/@symfony/stimulus-bundle/controllers-11c35dc7f11bbd855b8108888f18f9b7.js",
        "https://norbert.tech/assets/controllers/hello_controller.js": "https://norbert.tech/assets/controllers/hello_controller-55882fcad241d2bea50276ea485583bc.js",
        "https://norbert.tech/assets/controllers/syntax_highlight_controller.js": "https://norbert.tech/assets/controllers/syntax_highlight_controller-ae10e4cee8b4dedbf232536d05654062.js",
        "https://norbert.tech/assets/controllers/clipboard_controller.js": "https://norbert.tech/assets/controllers/clipboard_controller-6aefa8a9dec3271dae2f05b464bf9204.js",
        "highlight.js/lib/core": "https://norbert.tech/assets/vendor/highlight.js/lib/core-760145ef158caabe84ca07686407d093.js",
        "highlight.js/lib/languages/php": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/php-c0eb2105c14097e8a5a1e9a767e8ac95.js",
        "highlight.js/styles/github-dark.min.css": "data:application/javascript,document.head.appendChild%28Object.assign%28document.createElement%28%22link%22%29%2C%7Brel%3A%22stylesheet%22%2Chref%3A%22https%3A%2F%2Fnorbert.tech%2Fassets%2Fvendor%2Fhighlight.js%2Fstyles%2Fgithub-dark.min-4b46e20f66f76e35d6454ca4f09b57c3.css%22%7D%29%29",
        "@fontsource-variable/cabin/index.min.css": "data:application/javascript,document.head.appendChild%28Object.assign%28document.createElement%28%22link%22%29%2C%7Brel%3A%22stylesheet%22%2Chref%3A%22https%3A%2F%2Fnorbert.tech%2Fassets%2Fvendor%2F%40fontsource-variable%2Fcabin%2Findex.min-08e34691d22388e6974e6cb2bfbcbfd0.css%22%7D%29%29",
        "clipboard": "https://norbert.tech/assets/vendor/clipboard/clipboard.index-925566f98181665b5a61fea1bcd9033d.js",
        "highlight.js/lib/languages/shell": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/shell-664215791af27581e04813723523a355.js",
        "highlight.js/lib/languages/json": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/json-9ac51ad2a97f9ce56b2f309eb64d7b04.js",
        "highlight.js/lib/languages/twig": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/twig-0f3c6d18c0368650898b432b7bcf672a.js",
        "highlight.js/lib/languages/sql": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/sql-09f80640dd6fe9bed6ff4eb255b13f08.js",
        "highlight.js/lib/languages/javascript": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/javascript-100f963be02a503f0531e497103ff398.js",
        "highlight.js/lib/languages/xml": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/xml-a2295112e12d4d01f257d59e1cfa676d.js"
    }
}
</script>
<!-- ES Module Shims: Import maps polyfill for modules browsers without import maps support -->
<script async src="https://ga.jspm.io/npm:es-module-shims@1.10.0/dist/es-module-shims.js"></script>
<link rel="modulepreload" href="https://norbert.tech/assets/app-930adf3462cf9ab60908eb1b74cf7ca7.js">
<link rel="modulepreload" href="https://norbert.tech/assets/vendor/@oddbird/popover-polyfill/popover-polyfill.index-7979d53637476aa204f709644aed2c19.js">
<link rel="modulepreload" href="https://norbert.tech/assets/bootstrap-d78d7e12c819dedf89372fb4824c072d.js">
<link rel="modulepreload" href="https://norbert.tech/assets/vendor/htmx.org/htmx.org.index-023ae86a082913526422a6063298f898.js">
<link rel="modulepreload" href="https://norbert.tech/assets/vendor/iconify-icon/iconify-icon.index-8a41e423576dc2d752509fd455f508c1.js">
<link rel="modulepreload" href="https://norbert.tech/assets/@symfony/stimulus-bundle/loader-9311b8ea36bad0f6168e687b4d6dee73.js">
<link rel="modulepreload" href="https://norbert.tech/assets/vendor/@hotwired/stimulus/stimulus.index-304681764684182e6662e0931532ed91.js">
<link rel="modulepreload" href="https://norbert.tech/assets/@symfony/stimulus-bundle/controllers-11c35dc7f11bbd855b8108888f18f9b7.js">
<link rel="modulepreload" href="https://norbert.tech/assets/controllers/hello_controller-55882fcad241d2bea50276ea485583bc.js">
<script type="module">import 'app';</script>
                <script defer src="https://cloud.umami.is/script.js" data-website-id="9fed007d-d990-428b-b5d9-11c6ff55a3f1"></script>
    </head>
<body class="scroll-smooth text-black relative min-h-screen pb-16">
    <div class="sticky top-0 max-h-screen overflow-y-auto bg-white py-2 px-2 border-b border-gray-500 z-[9999] print:hidden">
        <div class="grid grid-cols-2 sm:mx-auto sm:max-w-screen-2xl md:px-4">
            <div class="text-left">
                <a href="/" class="text-lg">
                    norbert.tech
                </a>
            </div>
            <div class="text-right">
                <a href="/consulting" class="text-lg inline-flex items-center space-x-1 md:mr-4 mr-2">
                    <iconify-icon icon="lineicons:consulting" class="mr-1"></iconify-icon> Consulting
                </a>
                <a href="/blog" class="text-lg inline-flex items-center space-x-1">
                    <iconify-icon icon="ooui:articles-ltr" class="mr-1"></iconify-icon> Blog
                </a>
            </div>
        </div>
    </div>
    
    <main class="mx-auto max-w-screen-2xl mb-4 md:pt-4 px-4 lg:px-0">
            <div class="px-2 py-5 sm:px-4 md:px-8 lg:px-12 mx-auto max-w-4xl">
        <ul class="mt-2 pl-[20px] flex flex-wrap gap-2 sm:gap-4">
            <li>
                <a href="/blog" class="text-sm sm:text-base text-blue-500 hover:underline px-2 py-1 rounded">Go Back</a>
            </li>
                                                                <li>
                        <a href="/blog/2025-08-12/data-analytics-in-distributed-transactional-systems"
                           class="text-sm sm:text-lg px-2 py-1 rounded hover:opacity-80"
                           title="English">ğŸ‡ºğŸ‡¸ English</a>
                    </li>
                                                                                <li>
                        <a href="/blog/2025-08-12/fr/analyse-donnees-systemes-transactionnels-distribues"
                           class="text-sm sm:text-lg px-2 py-1 rounded hover:opacity-80"
                           title="French">ğŸ‡«ğŸ‡· French</a>
                    </li>
                                                                                <li>
                        <a href="/blog/2025-08-12/de/datenanalyse-in-verteilten-transaktionssystemen"
                           class="text-sm sm:text-lg px-2 py-1 rounded hover:opacity-80"
                           title="Deutsch">ğŸ‡©ğŸ‡ª Deutsch</a>
                    </li>
                                                                                <li>
                        <a href="/blog/2025-08-12/es/analisis-datos-sistemas-transaccionales-distribuidos"
                           class="text-sm sm:text-lg px-2 py-1 rounded hover:opacity-80"
                           title="Spanish">ğŸ‡ªğŸ‡¸ Spanish</a>
                    </li>
                                                                                <li>
                        <a href="/blog/2025-08-12/it/analisi-dati-sistemi-transazionali-distribuiti"
                           class="text-sm sm:text-lg px-2 py-1 rounded hover:opacity-80"
                           title="Italian">ğŸ‡®ğŸ‡¹ Italian</a>
                    </li>
                                    </ul>

            </div>
    <article class="blog-post">
            <div class="img-wide">
        <img src="https://norbert.tech/assets/images/blog/analytics-in-transactional-distributed-systems/analytics_01-b27f8a842f645a9c7d9901f3fd11fde8.jpg" alt="Analiza danych w rozproszonych systemach transakcyjnych" />
    </div>

    <h1 class="font-bold text-4xl mb-2" id="title">Analiza danych w rozproszonych systemach transakcyjnych</h1>
    <div class="mb-2">
        <small class="text-sm">Data Publikacji August 12, 2025 00:00</small>
    </div>
    <div class="mb-4">
                    <small><span class="badge badge-info">analiza danych</span></small>
                    <small><span class="badge badge-info">magazyn danych</span></small>
                    <small><span class="badge badge-info">ETL</span></small>
                    <small><span class="badge badge-info">przetwarzanie danych</span></small>
                    <small><span class="badge badge-info">systemy transakcyjne</span></small>
            </div>
    <p>
        W tym wpisie postaram siÄ™ poruszyÄ‡ problem analizy danych w rozproszonych systemach transakcyjnych.<br/>
        JeÅ¼eli szukasz pomysÅ‚Ã³w na zbudowanie centralnego magazynu danych, ktÃ³ry pozwoli zebraÄ‡ dane z caÅ‚ego systemu,
        niezaleÅ¼nie od jego fragmentacji a przy okazji nie utonÄ…Ä‡ w kosztach operacyjnych, to ten wpis jest dla Ciebie.
    </p>

    <h2>Wszystko zaczyna siÄ™ niewinnie</h2>
    <p>
        WiÄ™kszoÅ›Ä‡ systemÃ³w, ktÃ³re na co dzieÅ„ tworzymy, przechowuje dane w jakiejÅ› relacyjnej bazie danych.
        Bardzo popularnym, a przy okazji dobrym wyborem jest PostgreSQL, ktÃ³ry w ostatnich latach staÅ‚ siÄ™ niemalÅ¼e
        standardem w branÅ¼y.
    </p>
    <p>
        Historia wiÄ™kszoÅ›ci projektÃ³w wyglÄ…da przewaÅ¼nie bardzo podobnie: zaczynamy od weryfikacji pomysÅ‚u, zdobywamy
        pierwszych uÅ¼ytkownikÃ³w, system zaczyna zarabiaÄ‡, biznes kombinuje jak zwiÄ™kszyÄ‡ zyski, powstajÄ… nowe
        funkcjonalnoÅ›ci. KaÅ¼da nowa funkcjonalnoÅ›Ä‡ to kilka nowych tabelek w bazie danych.
    </p>
    <p>
        W celu przyÅ›pieszenia developmentu korzystamy z ORM-a, automatycznie generujemy migracje, ktÃ³re tworzÄ… i
        aktualizujÄ… schemat bazy danych.
    </p>
    <p>
        PoczÄ…tkowo wszystko idzie gÅ‚adko, nowe funkcjonalnoÅ›ci przynoszÄ… spodziewane zyski, biznes zaczyna siÄ™ skalowaÄ‡.
        Zatrudniamy wiÄ™cej programistÃ³w, aby tworzyÄ‡ wiÄ™cej funkcjonalnoÅ›ci rÃ³wnolegle.
    </p>
    <p>
        Od czasu do czasu ktoÅ› zgÅ‚asza, Å¼e system w niektÃ³rych miejscach zaczyna "zamulaÄ‡", szybki rekonesans, jeszcze
        szybsza
        diagnoza, brakuje indeksu w jakiejÅ› tabelce.
    </p>
    <p>
        W konfiguracji mapowaÅ„ ORM-a dokÅ‚adamy indeks na pole, po ktÃ³rym system bardzo czÄ™sto wyszukuje dane.
        Problem rozwiÄ…zany.
    </p>
    <p>
        PowiÄ™kszajÄ…cy siÄ™ zespÃ³Å‚ programistÃ³w przykÅ‚ada duÅ¼Ä… wagÄ™ do jakoÅ›ci, byÄ‡ moÅ¼e nawet posÅ‚uguje siÄ™
        zaawansowanymi technikami wytwarzania oprogramowania, jak Event Storming czy Domain-Driven Design.<br/>
        CI/CD wykonuje niezliczone iloÅ›ci testÃ³w, upewniajÄ…c siÄ™, Å¼e zmiany nie wprowadzajÄ… regresji.
    </p>
    <p>
        Idylla trwa, zespÃ³Å‚ lub byÄ‡ moÅ¼e wiele zespoÅ‚Ã³w zaczyna dokÅ‚adaÄ‡ nowe moduÅ‚y do systemu. ModuÅ‚y odpowiednio
        odizolowane, odpowiedzialne za konkretne zadania, nigdy nie przekraczajÄ…ce swoich granic i nie wchodzÄ…ce
        w kompetencje innych moduÅ‚Ã³w.
    </p>
    <p>
        Do komunikacji wykorzystywane sÄ… oczywiÅ›cie kolejki, implementujemy
        <a href="https://event-driven.io/en/outbox_inbox_patterns_and_delivery_guarantees_explained/" target="_blank">Outbox/Inbox
            Pattern</a>
    </p>
    <p>
        Aby zapewniÄ‡ odpowiedniÄ… izolacjÄ™, ustalamy reguÅ‚y mÃ³wiÄ…ce o tym, Å¼e kaÅ¼dy moduÅ‚ ma dostÄ™p jedynie
        do tych tabelek w bazie danych, ktÃ³re do niego naleÅ¼Ä…. W celu uzyskania danych z innego moduÅ‚u naleÅ¼y
        udaÄ‡ siÄ™ do tego moduÅ‚u, czy to za poÅ›rednictwem jakiegoÅ› wewnÄ™trznego API, czy w jakikolwiek inny sposÃ³b.
    </p>
    <p>
        Co jakiÅ› czas biznes przychodzi do nas z pytaniem <strong>czy moÅ¼ecie na szybko wygenerowaÄ‡ dla nas ten
            raport?</strong>.
        OczywiÅ›cie, kilka linijek w SQL'u, byÄ‡ moÅ¼e kilkadziesiÄ…t i raport gotowy.
    </p>
    <p>
        Biznes zadowolony, raport w postaci CSV leci do Excela (najbardziej popularnego narzÄ™dzia BI), biznes wyciÄ…ga
        wnioski,
        planuje nowe funkcjonalnoÅ›ci i zmiany.
    </p>
    <div class="img-wide">
        <img src="https://norbert.tech/assets/images/blog/analytics-in-transactional-distributed-systems/happy_business_01-c2e68a95166ed53f6bd111a6590e9909.jpg" alt="Business Intelligence" />
    </div>

    <h2>Czas pÅ‚ynie, nowe tabelki wyrastajÄ… jak grzyby po deszczu</h2>
    <p>
        W takim stanie rzeczy moÅ¼emy trwaÄ‡ bardzo dÅ‚ugo, nawet kilka dobrych lat.
    </p>
    <p>
        W miÄ™dzyczasie ktoÅ› gdzieÅ› na pewno wpadnie na pomysÅ‚, Å¼eby dodaÄ‡ do systemu moÅ¼liwoÅ›Ä‡ generowania raportÃ³w.
        To tylko i wyÅ‚Ä…cznie kwestia czasu.
    </p>
    <p>
        Raporty o stanie systemu to dla biznesu jedno z bardziej kluczowych narzÄ™dzi dajÄ…cych wglÄ…d w zachowania,
        preferencje
        czy trendy uÅ¼ytkownikÃ³w. PozwalajÄ… nie tylko zrozumieÄ‡, co siÄ™ dzieje, ale teÅ¼ odpowiednio zaplanowaÄ‡ to, co siÄ™
        ma dopiero wydarzyÄ‡.
    </p>
    <p>
        Im lepsze i bardziej szczegÃ³Å‚owe raporty, tym lepsze decyzje moÅ¼na na ich podstawie podejmowaÄ‡. Dobre
        decyzje biznesowe przekÅ‚adajÄ… siÄ™ na wiÄ™ksze zyski, wiÄ™ksze zyski przekÅ‚adajÄ… siÄ™ na wiÄ™kszy budÅ¼et.
        WiÄ™kszy budÅ¼et przekÅ‚ada siÄ™ na lepsze narzÄ™dzia, wiÄ™ksze zespoÅ‚y, lepsze wynagrodzenia czy premie.
    </p>
    <p>
        W interesie kaÅ¼dego programisty powinno byÄ‡ wiÄ™c dostarczanie biznesowi moÅ¼liwie jak najlepszych i jak
        najbardziej precyzyjnych danych, w koÅ„cu lepsze wyniki przekÅ‚adajÄ… siÄ™ bezpoÅ›rednio na lepsze zyski.
    </p>
    <h2>Pierwsze objawy</h2>
    <p>
        System dziaÅ‚a, przynosi zyski. SkÅ‚ada siÄ™ z okoÅ‚o 5, moÅ¼e nawet 10 moduÅ‚Ã³w, kaÅ¼dy moduÅ‚ skÅ‚ada siÄ™ z 20-50
        tabelek w
        bazie danych. KaÅ¼dy moduÅ‚ dostarcza swoje wÅ‚asne raporty.
    </p>
    <ul>
        <li>SprzedaÅ¼</li>
        <li>Marketing</li>
        <li>Logistyka</li>
        <li>Stany Magazynowe</li>
        <li>UÅ¼ytkownicy</li>
    </ul>
    <p>
        KaÅ¼dy moduÅ‚ udostÄ™pnia tylko czÄ™Å›Ä‡ danych, czÄ…stkÄ™ wiÄ™kszego obrazu, Å¼aden jednak nie daje podglÄ…du na caÅ‚oÅ›Ä‡.
    </p>
    <p>
        ZespoÅ‚y wprawdzie zaimplementowaÅ‚y klucze referencyjne do danych pochodzÄ…cych z innych moduÅ‚Ã³w, udaÅ‚o siÄ™ nawet
        w interfejsie uÅ¼ytkownika stworzyÄ‡ jedno miejsce z ktÃ³rego moÅ¼na wygenerowaÄ‡ raporty.
    </p>
    <p>
        To jednak dalej za maÅ‚o...
    </p>
    <p>
        Bardzo szybko okazuje siÄ™, Å¼e raporty generowane w rÃ³Å¼nych moduÅ‚ach, napisane przez rÃ³Å¼nych programistÃ³w, byÄ‡
        moÅ¼e nawet w rÃ³Å¼nych technologiach majÄ… rÃ³Å¼ne formaty danych, rÃ³Å¼ne standardy nazewnictwa.
    </p>
    <p>
        Inaczej interpretowane sÄ… zakresy dat, jeden moduÅ‚ uwzglÄ™dnia daty koÅ„ca i poczÄ…tku, drugi je wyklucza,
        a jeszcze inny robi przedziaÅ‚ prawostronnie otwarty w celu uÅ‚atwienia paginacji, bo akurat majÄ…
        teÅ¼ API i to API wykorzystuje ten sam kawaÅ‚ek kodu.
    </p>
    <p>
        PoniewaÅ¼ kaÅ¼dy moduÅ‚ jest niezaleÅ¼ny, posiada swoje granice, swÃ³jÄ… nomenklaturÄ™, w pewnym momencie orientujemy
        siÄ™,
        Å¼e to, co w jednym module nazywamy w jakiÅ› sposÃ³b, inny moduÅ‚ eksponuje pod zupeÅ‚nie innÄ… nazwÄ….
        PoniewaÅ¼ w kontekÅ›cie tego moduÅ‚u ma to sens.
    </p>
    <p>
        Po czasie pewnie teÅ¼ siÄ™ zorientujemy, Å¼e kaÅ¼dy zespÃ³Å‚ inaczej zdefiniowaÅ‚ sobie politykÄ™ retencji i
        przechowywania danych.
        Pomimo posiadania w kluczowym module danych z ostatnich 5 lat, nie moÅ¼emy nic z nimi zrobiÄ‡, bo moduÅ‚y, ktÃ³re
        dostarczaÅ‚y
        dane potrzebne do wzbogacenia podstawowego raportu, posiadajÄ… dane jedynie z ostatnich 2 lat.
    </p>
    <p>
        Nie sÄ… to jednak problemy, ktÃ³rych odrobina magii w Excelu nie byÅ‚aby w stanie rozwiÄ…zaÄ‡ (byÄ‡ moÅ¼e poza brakami
        w danych).
        Tym kolumnom zmienimy nazwy, te usuniemy, dodamy szybkie filtrowanko i wystarczy.
    </p>
    <p>
        Stworzymy sobie jeden wielki plik, w ktÃ³rym bÄ™dziemy mieli jeden arkusz o nazwie "Dashboard", a wszystkie
        inne bÄ™dÄ… tylko do odczytu, bÄ™dÄ… zasilaÅ‚y dashboard.
    </p>
    <p>
        ByÄ‡ moÅ¼e to podejÅ›cie bÄ™dzie nawet chwilÄ™ dziaÅ‚aÄ‡. ByÄ‡ moÅ¼e nawet dÅ‚uÅ¼ej niÅ¼ chwilÄ™, ale nie miejmy zÅ‚udzeÅ„.
        To wszystko w koÅ„cu padnie, i to zgodnie z prawami
        <a href="https://en.wikipedia.org/wiki/Murphy%27s_law" target="_blank">Murphiego</a>
        padnie w najgorszym moÅ¼liwym momencie.
    </p>
    <h2>Co zÅ‚ego jest w Excelu?</h2>
    <p>
        Nic! Excel to rewelacyjne narzÄ™dzie. Problem nie leÅ¼y w Excelu, ale w jego wykorzystaniu.
    </p>
    <p>
        Ta caÅ‚a magia polegajÄ…ca na oczyszczeniu i przygotowaniu danych nie powinna mieÄ‡ miejsca w Excelu, nie
        na wiÄ™kszÄ… skalÄ™. JeÅ¼eli mÃ³wimy o jednorazowym szybkim raporcie, nie ma problemu. Robimy co musimy,
        klepiemy formuÅ‚ki, analizujemy dane i zapominamy.
    </p>
    <p>
        JeÅ¼eli jednak ma to byÄ‡ czÄ™Å›Ä‡ naszej codziennej rutyny, jeÅ¼eli cyklicznie musimy przechodziÄ‡ przez ten sam
        proces, podÄ…Å¼ajÄ…c za nieustannymi zmianami i ewolucjÄ… systemu, prÄ™dzej czy pÃ³Åºniej okaÅ¼e siÄ™, Å¼e te arkusze sÄ…
        nieaktualne.
    </p>
    <p>
        Kolumny przestaÅ‚y istnieÄ‡ lub zmieniÅ‚y nazwy, powstaÅ‚y nowe kolumny, format danych ulegÅ‚ zmianie albo
        co gorsza, jeden z zespoÅ‚Ã³w opiekujÄ…cy siÄ™ jednym z moduÅ‚Ã³w usunÄ…Å‚ jakieÅ› dane bez Å›wiadomoÅ›ci, Å¼e byÅ‚y one
        wykorzystywane
        przez jakiegoÅ› uÅ¼ytkownika biznesowego gdzieÅ› w jednym z jego raportÃ³w, ktÃ³re otwiera raz na kwartaÅ‚.
    </p>
    <p>
        Na dÅ‚uÅ¼szÄ… metÄ™, bardziej zÅ‚oÅ¼one arkusze kalkulacyjne, ktÃ³re czerpiÄ… dane z automatycznie generowanych przez
        system raportÃ³w, ktÃ³re sÄ… nastÄ™pnie sklejane na podstawie niejawnych reguÅ‚, sÄ… nie do utrzymania.
    </p>
    <h2>To moÅ¼e podepniemy jakieÅ› narzÄ™dzie BI?</h2>
    <p>
        PomyÅ›laÅ‚o wielu programistÃ³w, ktÃ³rzy wielokrotnie zetknÄ™li siÄ™ z problemem generowania raportÃ³w.
    </p>
    <p>
        WeÅºmy na przykÅ‚ad taki <a href="https://www.metabase.com/" target="_blank">Metabase</a>. Darmowe narzÄ™dzie,
        ktÃ³re
        moÅ¼emy postawiÄ‡ w kilka minut za pomocÄ… Dockera.
    </p>
    <p>
        DaÄ‡ mu dostÄ™p do naszej bazy i kilku lub wszystkich tabelek, i za pomocÄ… bardzo przyjaznego interfejsu
        uÅ¼ytkownika biznes bÄ™dzie mÃ³gÅ‚ w bardzo Å‚atwy i przyjemny sposÃ³b wygenerowaÄ‡ najbardziej skomplikowane raporty.
    </p>
    <p>
        Raporty, ktÃ³re bÄ™dÄ… mogÅ‚y zawieraÄ‡ dane z wielu moduÅ‚Ã³w jednoczeÅ›nie!
    </p>
    <p>
        MoÅ¼emy nawet zatrudniÄ‡ analityka danych z podstawami SQL'a, ktÃ³ry wszystko to, czego nie bÄ™dzie
        siÄ™ daÅ‚o wyklikaÄ‡, osiÄ…gnie za pomocÄ… odpowiednio przygotowanego zapytania.
    </p>
    <h2>Tylko, Å¼e to nie rozwiÄ…zuje problemu</h2>
    <p>
        Jedynie odsuwa go w czasie.
    </p>
    <p>
        JeÅ¼eli przyjrzymy siÄ™ dokÅ‚adnie, co siÄ™ zmieniÅ‚o, to zmieniÅ‚a siÄ™ tylko jedna rzecz. NarzÄ™dzie...
        PrzenieÅ›liÅ›my problem oczyszczania i Å‚Ä…czenia danych z Excela do Metabase.
    </p>
    <p>
        Excel wprawdzie wrÃ³ciÅ‚ do swojej pierwotnej roli, moÅ¼emy teraz raporty pobrane z Metabase wrzuciÄ‡ do Excela.
    </p>
    <p>
        Jednak nasza niejawna logika Å‚Ä…czenia/oczyszczania danych przeniosÅ‚a siÄ™ z arkusza kalkulacyjnego do zapytaÅ„
        SQL.
    </p>
    <p>
        Poza tym, wszystkie problemy zostaÅ‚y takie same:
    </p>
    <ul>
        <li>niespÃ³jnoÅ›Ä‡ danych</li>
        <li>niespÃ³jnoÅ›Ä‡ nazewnictwa</li>
        <li>brak jednolitej polityki wstecznej kompatybilnoÅ›ci</li>
        <li>brak jednolitej polityki retencji danych</li>
    </ul>
    <h2>To moÅ¼e ustanowimy procesy i reguÅ‚y?</h2>
    <p>
        WiÄ™kszoÅ›Ä‡ z powyÅ¼szych problemÃ³w da siÄ™ rozwiÄ…zaÄ‡ implementujÄ…c odpowiednie procesy oraz reguÅ‚y.
    </p>
    <p>
        MoÅ¼emy ustaliÄ‡ standardy nazewnictwa mÃ³wiÄ…ce, Å¼e kaÅ¼da tabelka w bazie musi zawieraÄ‡ w nazwie prefix moduÅ‚u, a
        kolumny nazywane sÄ… maÅ‚ymi literami i odseparowane podkreÅ›leniami.
    </p>
    <p>
        MoÅ¼emy ustaliÄ‡, Å¼e kaÅ¼dy moduÅ‚ przechowuje dane z ostatnich 5 lat (hot storage), wszystko co starsze jest
        archiwizowane. (cold storage)
    </p>
    <p>
        MoÅ¼emy ustaliÄ‡, Å¼e zakresy dat zawsze traktowane sÄ… jako przedziaÅ‚y prawostronnie otwarte.
    </p>
    <p>
        MoÅ¼emy ustaliÄ‡, Å¼e nie usuwamy Å¼adnych kolumn z bazy danych, albo Å¼e przed usuniÄ™ciem czegokolwiek najpierw
        wchodzimy w okres przejÅ›ciowy, podczas ktÃ³rego pokazujemy kaÅ¼demu uÅ¼ytkownikowi systemu,
        ktÃ³re kolumny zmieniÄ… siÄ™ i w jaki sposÃ³b.
    </p>
    <p>
        Nawet jeÅ¼eli przyjmiemy na potrzeby dyskusji, Å¼e uda siÄ™ te procesy globalnie zaimplementowaÄ‡ pomiÄ™dzy kilkoma
        zespoÅ‚ami,
        oraz Å¼e te zespoÅ‚y bÄ™dÄ… ich bezwzglÄ™dnie i bardzo dokÅ‚adnie przestrzegaÄ‡, <strong>to nie wystarczy...</strong>
    </p>
    <h2>Skalowanie bazy danych nie jest tanie</h2>
    <p>
        SzczegÃ³lnie jeÅ¼eli opieramy siÄ™ o rozwiÄ…zania chmurowe.
    </p>
    <p>
        WyobraÅºmy sobie sytuacjÄ™, w ktÃ³rej w szczytowych godzinach pracy systemu (kiedy uÅ¼ytkownicy generujÄ… najwiÄ™cej
        transakcji)
        analityk biznesowy, ktÃ³ry pracuje wedÅ‚ug wÅ‚asnego planu musi wygenerowaÄ‡ raport w oparciu o taki typowy, SQLowy
        kilkutysiÄ™cznik?
    </p>
    <p>
        Analityk odpala zapytanie, baza danych zaczyna mieliÄ‡. Zapytanie trwa, 5, 10, 15 minut.
        Baza danych zaczyna siÄ™ pociÄ‡.
    </p>
    <p>
        UÅ¼ytkownicy bombardujÄ… system nowymi zamÃ³wieniami (lub jakimikolwiek innymi operacjami, ktÃ³re generujÄ… sporo
        zapisÃ³w)
        w czasie kiedy analityk czeka na wyniki.
    </p>
    <p>
        W tym samym momencie ktoÅ› z biznesu potrzebuje na szybko sprawdziÄ‡ kilka raportÃ³w, kaÅ¼dy z nich zawiera
        "caÅ‚kowitÄ… liczbÄ™ wierszy w tabelce".
        Takich osÃ³b jest kilka.
    </p>
    <p>
        Wszystkie te operacje nakÅ‚adajÄ… siÄ™ na siebie, nasza juÅ¼ i tak bardzo obciÄ…Å¼ona baza danych nie wyrabia.
    </p>
    <p>
        NiektÃ³re transakcje uÅ¼ytkownikÃ³w nie dochodzÄ… do skutku. <br/>
        System ledwo dyszy. Czas oczekiwania na najbardziej podstawowe operacje mierzony jest w sekundach.
    </p>
    <p>
        A teraz wisienka na torcie, kiedy te wszystkie dantejskie sceny majÄ… miejsce, kiedy Pager Duty jest rozgrzany do
        czerwonoÅ›ci od wszelkiego typu i rodzaju incydentÃ³w, kiedy zespoÅ‚y w panice prÃ³bujÄ… przywrÃ³ciÄ‡ system do Å¼ycia,
        devopsi kombinujÄ… jak na szybko przeskalowaÄ‡ bazÄ™ danych...
    </p>
    <div class="img-wide">
        <img class="mt-[-150px]" src="https://norbert.tech/assets/images/blog/analytics-in-transactional-distributed-systems/construction_01-59e51f16aa79ecadc241f490217f29a0.jpg" alt="Prace remontowe" />
    </div>
    <p>
        CEO zaczyna prezentacjÄ™ dla potencjalnego partnera biznesowego, z ktÃ³rym wspÃ³Å‚praca
        ma okazaÄ‡ siÄ™ kluczowa w strategii rozwoju firmy...
    </p>
    <h2>To moÅ¼e po prostu postawmy replikÄ™?</h2>
    <p>
        W koÅ„cu raporty nie bÄ™dÄ… przeciÄ…Å¼aÄ‡ naszej bazy transakcyjnej.
    </p>
    <p>
        Podwoimy wprawdzie koszty utrzymania bazy danych, ale zredukujemy ryzyko przeciÄ…Å¼enia systemu i bÄ™dziemy
        mogli podpiÄ…Ä‡ ulubione narzÄ™dzie business intelligence wprost na replikÄ™, co da nam dane real time.
    </p>
    <p>
        Brzmi rewelacyjnie, ale w praktyce nie jest to tak proste.
    </p>
    <p>
        PomijajÄ…c juÅ¼ nawet potencjalne problemy wynikajÄ…ce z samej natury replikacji, gÅ‚Ã³wnym i podstawowym problemem
        na ktÃ³ry najczÄ™Å›ciej trafiam, jest <strong>percepcja</strong>.
    </p>
    <p>
        ZupeÅ‚nie inaczej na tabele w bazie danych bÄ™dzie patrzyÅ‚ programista, ktÃ³ry te tabele wygenerowaÅ‚ za pomocÄ…
        mapowaÅ„ ORM-a, niÅ¼ analityk danych.
    </p>
    <p>
        Programista bÄ™dzie wiedziaÅ‚, ktÃ³re tabele naleÅ¼y poÅ‚Ä…czyÄ‡ razem, aby otrzymaÄ‡ obraz caÅ‚oÅ›ci.
        BÄ™dzie rozumiaÅ‚ ograniczenia i warunki zaszyte gdzieÅ› w kodzie aplikacji.
        Przede wszystkim programista zna lub chociaÅ¼ powinien siÄ™ orientowaÄ‡ jak wyglÄ…da cykl Å¼ycia systemu (jego
        danych).
    </p>
    <p>
        Ta caÅ‚a wiedza najczÄ™Å›ciej nie jest dostÄ™pna dla analitykÃ³w.
    </p>
    <p>
        To tak jakby powiedzieÄ‡ komuÅ›, Å¼eby spojrzaÅ‚ na coÅ› przez dziurkÄ™ od klucza. CoÅ› na pewno da siÄ™ zobaczyÄ‡.
        JakieÅ› wnioski da siÄ™ wyciÄ…gnÄ…Ä‡, ale bardzo ciÄ™Å¼ko bÄ™dzie odbudowaÄ‡ caÅ‚oÅ›Ä‡.
    </p>
    <p>
        Wystarczy, Å¼e mamy w bazie danych kolumnÄ™ typu JSONB w ktÃ³rej przechowujemy jakieÅ› struktury danych.
        ZaÅ‚Ã³Å¼my, Å¼e system dopuszcza 3 poprawne kombinacje tej samej struktury, ale jedna jest super rzadka, na tyle
        rzadka, Å¼e jeszcze w systemie nie wystÄ…piÅ‚a. PatrzÄ…c na dane, nawet caÅ‚oÅ›ciowo, analityk po prostu nie moÅ¼e wiedzieÄ‡,
        Å¼e istniejÄ… 3 kombinacje jednej struktury. Podczas normalizacji uwzglÄ™dni 2 przypadki, podczas gdy trzeci
        stanie siÄ™ tykajÄ…cÄ… bombÄ… zegarowÄ…, ktÃ³ra wybuchnie jak zawsze w najmniej oczekiwanym momencie.
    </p>
    <p>
        Inaczej mÃ³wiÄ…c, jeÅ¼eli mamy w systemie kilka niezaleÅ¼nych moduÅ‚Ã³w. KaÅ¼dy z swojÄ… bazÄ… danych, albo przynajmniej
        swoimi tabelami w bazie. Co sumarycznie daje nam 200-300 tabelek, oczekiwanie, Å¼e analityk to bez problemu
        ogarnie, nie popeÅ‚ni bÅ‚Ä™dÃ³w i raporty nie bÄ™dÄ… odbiegaÅ‚y od oczekiwaÅ„, jest delikatnie mÃ³wiÄ…c naiwne.
    </p>
    <p>
        Mimo wszystko wystawienie kopii/repliki bazy danych dla analitykÃ³w i nadanie jej 4-literowej nazwy pochodzÄ…cej
        od sÅ‚owa "analytics" dalej jest powszechnie stosowane.
    </p>
    <p>
        NarzÄ™dzia BI przeÅ›cigajÄ… siÄ™ w tym, kto stworzy lepszy interfejs uÅ¼ytkownika, dziÄ™ki ktÃ³remu raporty da siÄ™
        wyklikaÄ‡.
        ObiecujÄ…, Å¼e bÄ™dziemy mogli analizowaÄ‡ dane bez SQL.
    </p>
    <p>
        Tak, to moÅ¼e dziaÅ‚aÄ‡, w wielu miejscach wÅ‚aÅ›nie tak to dziaÅ‚a. O czym jednak gÅ‚oÅ›no nie mÃ³wimy to:
    </p>
    <ul>
        <li>Problemy z wstecznÄ… kompatybilnoÅ›ciÄ… oraz zmianami struktury danych</li>
        <li>Problemy z odpowiednim utrzymaniem / wersjonowaniem / testowaniem gigantycznych zapytaÅ„ SQL/skryptÃ³w
            normalizujÄ…cych dane w locie
        </li>
        <li>Repliki/Kopie generujÄ… dodatkowe koszty</li>
        <li>Redukcja zasobÃ³w replik jest albo niemoÅ¼liwa, albo uniemoÅ¼liwia generowanie raportÃ³w w akceptowalnych
            czasach
        </li>
    </ul>
    <p>
        Co w rezultacie odbija siÄ™ na jakoÅ›ci danych i skutecznoÅ›ci podejmowania decyzji biznesowych.
    </p>
    <h2>Co nam pozostaje?</h2>
    <p>
        MoÅ¼e najpierw ustalmy jakie problemy w pierwszej kolejnoÅ›ci chcemy rozwiÄ…zaÄ‡:
    </p>
    <div class="img-wide">
        <img src="https://norbert.tech/assets/images/blog/analytics-in-transactional-distributed-systems/strategy_01-f82682bfa13643ba5b8957e806e0d823.jpg" alt="Strategia i analiza" />
    </div>
    <ol>
        <li>Analizowanie danych / generowanie raportÃ³w nie moÅ¼e mieÄ‡ Å¼adnego wpÅ‚ywu na pracÄ™ systemu.</li>
        <li>Dane w raportach muszÄ… byÄ‡ zawsze Å›wieÅ¼e (dopuszczalny jest opÃ³Åºnienie w danych, ustalane indywidualnie)</li>
        <li>Raporty muszÄ… odzwierciedlaÄ‡ realny, niewypaczony stan systemu</li>
        <li>Struktura danych musi byÄ‡ odporna na regresjÄ™</li>
        <li>SpÃ³jna polityka retencji i archiwizowania danych</li>
    </ol>
    <h2>1) Separacja ZasobÃ³w</h2>
    <p>
        Nie jest to nic odkrywczego, jeÅ¼eli nie chcemy, Å¼eby nasz system byÅ‚ naraÅ¼ony na przeciÄ…Å¼enia
        wynikajÄ…ce z naduÅ¼ywania bazy danych poprzez generowanie raportÃ³w, musimy postawiÄ‡ sobie osobnÄ… bazÄ™ danych.
    </p>
    <p><strong>JakÄ… bazÄ™ wybraÄ‡ pod analitykÄ™?</strong></p>
    <p>
        To jest w zasadzie temat na osobny artykuÅ‚ albo nawet seriÄ™ artykuÅ‚Ã³w.
        RozwiÄ…zaÅ„ jest bardzo duÅ¼o, jedne lepsze, inne gorsze. Nie istnieje jedno
        magiczne rozwiÄ…zanie na wszystkie problemy.
    </p>
    <p>
        Moja rada, szczegÃ³lnie dla mniejszych zespoÅ‚Ã³w, niedoÅ›wiadczonych w zarzÄ…dzaniu danymi jest taka, Å¼eby nie
        rzucaÄ‡ siÄ™ na technologie, z ktÃ³rÄ… nie mamy doÅ›wiadczenia.
    </p>
    <p>
        Kluczowy jest odpowiedni format danych. Po zamianie wielu wÄ…skich tabelek na jednÄ… szerokÄ… najprawdopodobniej
        okaÅ¼e siÄ™, Å¼e generowanie tego samego raportu tylko bez uÅ¼ywania 20x <code>JOIN</code> nie zajmuje juÅ¼ 10 minut
        a mniej niÅ¼ pÃ³Å‚ sekundy.
    </p>
    <p>
        A co jeÅ¼eli problemem sÄ… agregacje, a nie Å‚Ä…czenia?
    </p>
    <p>
        Wtedy, zamiast agregowaÄ‡ w locie, lepiej przygotowaÄ‡ tabelÄ™ zawierajÄ…cÄ… te dane w formie zagregowanej, a nie
        surowej.
    </p>
    <h2>2) ÅšwieÅ¼e Dane</h2>
    <p>
        No dobra, ale skoro tworzymy nowÄ…, niezaleÅ¼nÄ… bazÄ™ danych, to w jaki sposÃ³b zadbamy o to aby dane w tej
        bazie byÅ‚y Å›wieÅ¼e i aktualne?
    </p>
    <p>
        Tutaj bardzo duÅ¼o zaleÅ¼y od dopuszczalnego opÃ³Åºnienia w synchronizacji danych.
        NajczÄ™Å›ciej wystarczy jak baza analityczna jest okoÅ‚o 24 godziny za bazÄ… transakcyjnÄ…. Czyli zawiera
        dane do "wczoraj", uwzglÄ™dniajÄ…c caÅ‚e "wczoraj".
    </p>
    <p>
        Dlaczego? Bo maÅ‚o ktÃ³re decyzje biznesowe podejmowane sÄ… w danej chwili.
        JeÅ¼eli jakieÅ› decyzje muszÄ… byÄ‡ podejmowane w tak krÃ³tkim czasie, wtedy buduje siÄ™ wÅ‚aÅ›ciwe automatyzacje.
    </p>
    <p>
        JeÅ¼eli 24-godzinne opÃ³Åºnienie jest akceptowalne (czasami nie jest i na to teÅ¼ sÄ… sposoby),
        wystarczy, Å¼e synchronizacje przeprowadzimy kilka razy dziennie.
        OczywiÅ›cie tu teÅ¼ nie ma zÅ‚otej reguÅ‚y. Tak samo jak nie ma reguÅ‚y mÃ³wiÄ…cej jak duÅ¼y zakres synchronizowaÄ‡ na raz.
    </p>
    <p>
        Jest za to jedna dobra praktyka, ktÃ³ra uÅ‚atwia synchronizacjÄ™. Polega ona na upewnieniu siÄ™, Å¼e gÅ‚Ã³wne tabele w
        systemie transakcyjnym zawierajÄ… datÄ™ utworzenia/modyfikacji rekordu.
    </p>
    <p>
        PosiadajÄ…c te dwie informacje jesteÅ›my w stanie zawÄ™ziÄ‡ okno synchronizacji do jakiegoÅ› okreÅ›lonego okresu czasu.
    </p>
    <p>
        Jak to w praktyce wyglÄ…da? MoÅ¼emy np. odpalaÄ‡ proces synchronizacji co 6 godzin, zbierajÄ…c tylko rekordy zmienione w
        ciÄ…gu ostatnich 24 godzin.<br/>
        <code>OczywiÅ›cie to sÄ… przykÅ‚adowe liczby, te wartoÅ›ci trzeba ustaliÄ‡ na podstawie rozmiaru i zachowania danych.</code>
    </p>
    <p>
        Dlaczego z 24 godzin? Takie dodatkowe zabezpieczenie. MoglibyÅ›my pobieraÄ‡ dane tylko z 7 godzin, ale jeÅ¼eli z jakiegokolwiek
        powodu synchronizacja siÄ™ nie wykona, a my tego nie wyÅ‚apiemy, moÅ¼emy straciÄ‡ dane.
    </p>
    <h2>3) Odzwierciedlenie Stanu Systemu</h2>
    <p>
        Moja opinia na ten temat moÅ¼e wydaÄ‡ siÄ™ kontrowersyjna, ale uwaÅ¼am, Å¼e najlepszÄ… wiedzÄ™ na temat danych i zachowania
        systemu czy moduÅ‚u ma zespÃ³Å‚, ktÃ³ry ten system/moduÅ‚ buduje.
    </p>
    <p>
        To wÅ‚aÅ›nie ten zespÃ³Å‚ powinien byÄ‡ odpowiedzialny za to, Å¼eby dane, ktÃ³re sÄ… generowane przez system lub jego czÄ™Å›Ä‡
        za ktÃ³rÄ… dany zespÃ³Å‚ odpowiada, trafiaÅ‚y do centralnego repozytorium danych.
    </p>
    <p>
        Innymi sÅ‚owy, to wÅ‚aÅ›nie zespÃ³Å‚ implementujÄ…cy danÄ… funkcjonalnoÅ›Ä‡ powinien na podstawie zebranych wczeÅ›niej wymagaÅ„
        przeksztaÅ‚ciÄ‡ te dane do odpowiedniego formatu i wypchnÄ…Ä‡ dalej.
    </p>
    <p>
        Jest to chyba najÅ‚atwiejszy sposÃ³b upewnienia siÄ™, Å¼e dane sÄ… kompletne a programiÅ›ci z danego zespoÅ‚u sÄ…
        Å›wiadomi, Å¼e te dane sÄ… gdzieÅ› wykorzystywane. Format danych analitycznych staje siÄ™ dla nich
        swego rodzaju kontraktem â€“ kontraktem, ktÃ³rego muszÄ… przestrzegaÄ‡.
    </p>
    <p>
        Nie rÃ³Å¼ni siÄ™ to bardzo od kontraktu na schemat API.
    </p>
    <h2>4) OdpornoÅ›Ä‡ na regresjÄ™</h2>
    <p>
        Ten punkt jest chyba najbardziej skomplikowany. Poprawna implementacja ewolucji schematu danych jest
        czÄ™sto nie tyle trudna, co kÅ‚opotliwa.
    </p>
    <p>
        W duÅ¼ym skrÃ³cie zasady wyglÄ…dajÄ… tak:
    </p>
    <ul>
        <li>Nigdy nie usuwamy kolumn</li>
        <li>Wszystkie kolumny, ktÃ³re dodajemy muszÄ… byÄ‡ <code>nullable</code> albo posiadaÄ‡ wartoÅ›Ä‡ domyÅ›lnÄ…</li>
        <li>Typy kolumn moÅ¼emy tylko rozszerzaÄ‡ przykÅ‚adowo, <code>int</code> moÅ¼emy zamieniÄ‡ na <code>bigint</code> ale nie na odwrÃ³t</li>
        <li>Nie zmieniamy nazw kolumn</li>
    </ul>
    <p>
        Czy w takim razie nie moÅ¼emy niczego usuwaÄ‡?
    </p>
    <p>
        MoÅ¼emy, ale nie byle jak. Generalnie to jak i jak czÄ™sto bÄ™dziemy Å‚amaÄ‡ wstÄ™cznÄ… kompatybilnoÅ›Ä‡ zaleÅ¼y tylko od nas.
    </p>
    <p>
        JeÅ¼eli z naszego ÅºrÃ³dÅ‚a danych analitycznych korzystamy tylko wewnÄ™trznie i, powiedzmy, analityk zajmujÄ…cy siÄ™ budowaniem
        raportÃ³w jest na bieÅ¼Ä…co z zmianami w systemie, przy odpowiedniej koordynacji moglibyÅ›my dodaÄ‡
        nowe tabelki, a nastÄ™pnie usunÄ…Ä‡ stare, dajÄ…c mu chwilÄ™ na zaktualizowanie raportÃ³w.
    </p>
    <p>
        JeÅ¼eli jednak nasze ÅºrÃ³dÅ‚o danych analitycznych wykorzystywane jest do <code>Data Science</code>, ale pracujemy w Å›rodowisku
        multi-tenancy i dane analityczne/raporty udostÄ™pniane sÄ… klientom, wtedy do sprawy musimy podejÅ›Ä‡ zupeÅ‚nie inaczej.
    </p>
    <h2>Polityka przechowywania i archiwizowania danych</h2>
    <p>
        Tak jak wspominaÅ‚em wyÅ¼ej, bardzo istotne jest, aby dane w bazie analitycznej, szczegÃ³lnie dostarczane przez rÃ³Å¼ne
        moduÅ‚y podlegaÅ‚y tym samym reguÅ‚om odnoÅ›nie czasu przechowywania.
    </p>
    <p>
        JeÅ¼eli stany magazynowe w systemie trzymamy tylko z ostatniego roku, a zamÃ³wienia z ostatnich 5 lat,
        Analitycy nie bÄ™dÄ… w stanie zbudowaÄ‡ raportu, ktÃ³ry bÄ™dzie zawieraÅ‚ dane z obu tych ÅºrÃ³deÅ‚.
    </p>
    <p>
        Jest to bardziej problem natury formalnej niÅ¼ technicznej. WydawaÅ‚o by siÄ™, Å¼e wystarczy siÄ™ po prostu dogadaÄ‡,
        jednak w praktyce nie jest to takie proste.
    </p>
    <p>
        Aby ustaliÄ‡ wspÃ³lnÄ… politykÄ™ przechowywania i archiwizowania danych naleÅ¼y wziÄ…Ä‡ pod uwagÄ™ nie tylko aspekty
        techniczne, ale rÃ³wnieÅ¼ prawne, biznesowe czy wÅ‚aÅ›nie analityczne, co moÅ¼e wymagaÄ‡ kompromisÃ³w.
    </p>
    <h2>PrzykÅ‚ady</h2>
    <p>
        Popatrzmy teraz na prosty przykÅ‚ad procesu ETL, ktÃ³rego zadaniem jest przeniesienie danych z bazy transakcyjnej
        do bazy analitycznej.
    </p>
    <blockquote>
        W tym przykÅ‚adzie wykorzystam <a href="https://flow-php.com" target="_blank">Flow PHP</a>, nie jest to
        jednak coÅ› specjalnie unikalnego dla PHP. W kaÅ¼dym jÄ™zyku moÅ¼emy zbudowaÄ‡ coÅ› bardzo podobnego za pomocÄ…
        jakiejkolwiek biblioteki uÅ‚atwiajÄ…cej tworzenie aplikacji CLI oraz jakiegoÅ› narzÄ™dzia do przetwarzania danych.
    </blockquote>
    <p>
        PoniÅ¼szy przykÅ‚ad (w nieco zmienionej postaci) pochodzi z sesji live stream, ktÃ³rÄ… miaÅ‚em przyjemnoÅ›Ä‡ nagrywaÄ‡ z Rolandem prowadzÄ…cym kanaÅ‚ <a href="https://nevercodealone.de/de" target="_blank">Never Code Alone</a>.
        MateriaÅ‚ video znajdziesz na portalu YouTube pod frazÄ… "Flow PHP"
    </p>
    <p>
        ZaÅ‚Ã³Å¼my, Å¼e tak mniej wiÄ™cej wyglÄ…da format zamÃ³wieÅ„:
    </p>
    <pre><code class="code-shell" data-controller="syntax-highlight">schema
|-- order_id: ?uuid
|-- seller_id: uuid
|-- created_at: datetime
|-- updated_at: datetime
|-- cancelled_at: ?datetime
|-- discount: ?float
|-- email: string
|-- customer: string
|-- address: map&lt;string, string&gt;
|-- notes: list&lt;string&gt;
|-- items: list&lt;structure{sku: string, quantity: integer, price: float}&gt;</code></pre>

    <p>
        Naszym celem jest przeniesienie tych zamÃ³wieÅ„ do analitycznej bazy danych, przygotujmy wiÄ™c schemat danych
        wejÅ›ciowych jak i docelowych.
    </p>

    <pre><code class="code-php" data-controller="syntax-highlight">&lt;?php

declare(strict_types=1);

namespace App\DataFrames;

// use statements

final class Orders
{
    public static function sourceSchema() : Schema
    {
        return schema(
            uuid_schema(&quot;order_id&quot;),
            uuid_schema(&quot;seller_id&quot;),
            datetime_schema(&quot;created_at&quot;),
            datetime_schema(&quot;updated_at&quot;, nullable: true),
            datetime_schema(&quot;cancelled_at&quot;, nullable: true),
            float_schema(&quot;discount&quot;, nullable: true),
            string_schema(&quot;email&quot;),
            string_schema(&quot;customer&quot;),
            map_schema(&quot;address&quot;, type: type_map(key_type: type_string(), value_type: type_string())),
            list_schema(&quot;notes&quot;, type: type_list(element: type_string())),
            list_schema(&quot;items&quot;, type: type_list(element: type_structure(elements: [&quot;item_id&quot; =&gt; type_string(), &quot;sku&quot; =&gt; type_string(), &quot;quantity&quot; =&gt; type_integer(), &quot;price&quot; =&gt; type_float()]))),
        );
    }

    public static function destinationSchema() : Schema
    {
        return self::sourceSchema()
            -&gt;replace(&#039;updated_at&#039;, datetime_schema(&quot;updated_at&quot;))
            -&gt;remove(&#039;address&#039;)
            -&gt;add(
                string_schema(&#039;street&#039;, metadata: DbalMetadata::length(2048)),
                string_schema(&#039;city&#039;, metadata: DbalMetadata::length(512)),
                string_schema(&#039;zip&#039;, metadata: DbalMetadata::length(32)),
                string_schema(&#039;country&#039;, metadata: DbalMetadata::length(128)),
            )
            -&gt;remove(&#039;items&#039;)
            -&gt;add(
                uuid_schema(&#039;item_id&#039;, metadata: DbalMetadata::primaryKey()),
                string_schema(&#039;sku&#039;, metadata: DbalMetadata::length(64)),
                integer_schema(&#039;quantity&#039;),
                integer_schema(&#039;price&#039;),
                string_schema(&#039;currency&#039;, metadata: DbalMetadata::length(3)),
            )
            ;
    }
}</code></pre>

    <p>
        ZwrÃ³Ä‡my uwagÄ™ na to, Å¼e docelowa struktura tabeli nie jest juÅ¼ zorientowana na zamÃ³wienia, a na zamÃ³wione przedmioty.
        Naszym celem jest rozpakowanie przedmiotÃ³w zamÃ³wieÅ„ tak, aby kaÅ¼dy byÅ‚ osobnym wierszem.
    </p>
    <p>
        DziÄ™ki temu analityk, ktÃ³ry bÄ™dzie musiaÅ‚ wygenerowaÄ‡ raport, nie bÄ™dzie juÅ¼ musiaÅ‚ kombinowaÄ‡ i rozpakowywaÄ‡
        jsona w locie.
    </p>
    <p>
        Kolumna Adres teÅ¼ zostaÅ‚a rozbita na kilka kolumn, dziÄ™ki czemu raport bÄ™dzie moÅ¼na Å‚atwiej
        filtrowaÄ‡.
    </p>
    <p>
        KolejnÄ… istotnÄ… transformacjÄ… jest zamiana <code>price</code> z <code>float</code> na <code>int</code>
        poprzez przemnoÅ¼enie wartoÅ›ci zmiennoprzecinkowej przez 100.
    </p>
    <p>
        OstatniÄ… juÅ¼ zmianÄ… bÄ™dzie dodanie informacji o tym, w jakiej walucie podawane sÄ… ceny. Tylko skÄ…d ta informacja
        pochodzi? Jest to wÅ‚aÅ›nie bardzo istotny szczegÃ³Å‚ wynikajÄ…cy z niezbyt dobrej implementacji.
        W tym konkretnym przypadku wszystkie zamÃ³wienia sÄ… w dolarach. System o tym wie, programiÅ›ci o tym wiedzÄ…,
        ale osoba patrzÄ…ca na tabelki w bazie bez kontekstu nie musi wcale posiadaÄ‡ takiej wiedzy.
    </p>
    <p>
        Nasza docelowa struktura powinna wyglÄ…daÄ‡ mniej wiÄ™cej w taki sposÃ³b:
    </p>

    <pre><code class="code-shell" data-controller="syntax-highlight">schema
|-- order_id: uuid
|-- seller_id: uuid
|-- created_at: datetime
|-- updated_at: datetime
|-- cancelled_at: ?datetime
|-- discount: ?float
|-- email: string
|-- customer: string
|-- notes: list&lt;string&gt;
|-- street: string
|-- city: string
|-- zip: string
|-- country: string
|-- item_id: uuid
|-- sku: string
|-- quantity: integer
|-- price: integer
|-- currency: string</code></pre>

    <p>
        NastÄ™pnym krokiem bÄ™dzie utworzenie odpowiedniej tabelki w bazie analitycznej. MoÅ¼emy to osiÄ…gnÄ…Ä‡ stosunkowo
        Å‚atwo dziÄ™ki adapterowi dla Doctrine DBAL.
    </p>

    <pre><code class="code-php" data-controller="syntax-highlight">&lt;?php

declare(strict_types=1);

namespace App\Dbal;

// use statements

final class SchemaProvider implements MigrationsSchemaProvider
{
    public const ANALYTICAL_ORDER_LINE_ITEMS = &#039;order_line_items&#039;;

    public function createSchema(): Schema
    {
        return new Schema(
            tables: [
                to_dbal_schema_table(Orders::destinationSchema(), self::ANALYTICAL_ORDER_LINE_ITEMS),
            ]
        );
    }
}</code></pre>

    <p>
        W bazie analitycznej przechowywaÄ‡ bÄ™dziemy wiÄ™c "uproszczonÄ…" lub "znormalizowanÄ…" wersjÄ™ tabeli z zamÃ³wieniami.
        Normalizacja polega na rozpakowaniu przedmiotÃ³w zamÃ³wienia i uczynieniach ich osobnymi wierszami oraz
        rozbiciu kolumny "Adres" na kilka kolumn.
    </p>

    <p>
        Przyjrzyjmy siÄ™ wiÄ™c komendzie CLI, ktÃ³ra bÄ™dzie odpowiedzialna za przeniesienie danych z bazy transakcyjnej
        do bazy analitycznej.
    </p>

    <pre><code class="code-php" data-controller="syntax-highlight">&lt;?php

namespace App\Command;

// use statements

#[AsCommand(
    name: &#039;app:orders:import&#039;,
    description: &#039;Import orders from the transactional database to the analytical database.&#039;,
)]
class OrdersImportCommand extends Command
{
    public function __construct(
        private readonly Connection $transactional,
        private readonly Connection $analytical,
    )
    {
        parent::__construct();
    }

    protected function configure()
    {
        $this-&gt;addOption(&#039;start-date&#039;, null, InputOption::VALUE_REQUIRED, &#039;Start date for the data pull.&#039;, &#039;-24 hours&#039;)
            -&gt;addOption(&#039;end-date&#039;, null, InputOption::VALUE_REQUIRED, &#039;End date for the data pull.&#039;, &#039;now&#039;)
        ;
    }


    protected function execute(InputInterface $input, OutputInterface $output): int
    {
        $io = new SymfonyStyle($input, $output);

        $io-&gt;title(&#039;Importing orders&#039;);

        $startDate = type_datetime()-&gt;cast($input-&gt;getOption(&#039;start-date&#039;));
        $endDate = type_datetime()-&gt;cast($input-&gt;getOption(&#039;end-date&#039;));

        $io-&gt;progressStart();

        $report = data_frame()
            -&gt;read(
                from_dbal_key_set_qb(
                    $this-&gt;transactional,
                    $this-&gt;transactional-&gt;createQueryBuilder()
                        -&gt;select(&#039;*&#039;)
                        -&gt;from(SchemaProvider::ORDERS)
                        -&gt;where(&#039;updated_at BETWEEN :start_date AND :end_date&#039;)
                        -&gt;setParameter(&#039;start_date&#039;, $startDate-&gt;format(&#039;Y-m-d H:i:s&#039;))
                        -&gt;setParameter(&#039;end_date&#039;, $endDate-&gt;format(&#039;Y-m-d H:i:s&#039;)),
                    pagination_key_set(
                        pagination_key_desc(&#039;updated_at&#039;),
                        pagination_key_desc(&#039;order_id&#039;)
                    )
                )-&gt;withSchema(Orders::sourceSchema())
            )
            -&gt;withEntry(&#039;_address&#039;, ref(&#039;address&#039;)-&gt;unpack())
            -&gt;renameEach(rename_replace(&#039;_address.&#039;, &#039;&#039;))
            -&gt;withEntry(&#039;_item&#039;, ref(&#039;items&#039;)-&gt;expand())
            -&gt;withEntry(&#039;_item&#039;, ref(&#039;_item&#039;)-&gt;unpack())
            -&gt;renameEach(rename_replace(&#039;_item.&#039;, &#039;&#039;))
            -&gt;drop(&#039;_item&#039;, &#039;items&#039;, &#039;address&#039;)
            -&gt;withEntry(&#039;currency&#039;, lit(&#039;USD&#039;))
            -&gt;withEntry(&#039;price&#039;, ref(&#039;price&#039;)-&gt;multiply(100))
            -&gt;constrain(constraint_unique(&#039;item_id&#039;))
            -&gt;match(Orders::destinationSchema())
            -&gt;write(
                to_dbal_table_insert(
                    $this-&gt;analytical,
                    SchemaProvider::ORDER_LINE_ITEMS,
                    SqliteInsertOptions::fromArray([
                        &#039;conflict_columns&#039; =&gt; [&#039;item_id&#039;],
                    ])
                )
            )
            -&gt;run(function (Rows $rows) use ($io) {
                $io-&gt;progressAdvance($rows-&gt;count());
            }, analyze: analyze())
        ;

        $io-&gt;progressFinish();

        $io-&gt;newLine();

        $io-&gt;definitionList(
            &#039;Orders Import Summary&#039;,
            new TableSeparator(),
            [&#039;Execution time &#039; =&gt; \number_format($report-&gt;statistics()-&gt;executionTime-&gt;highResolutionTime-&gt;seconds) . &#039; seconds&#039;],
            [&#039;Memory usage &#039; =&gt; \number_format($report-&gt;statistics()-&gt;memory-&gt;max()-&gt;inMb()) . &#039; MB&#039;],
            [&#039;Rows inserted &#039; =&gt; \number_format($report-&gt;statistics()-&gt;totalRows())],
        );

        return Command::SUCCESS;
    }
}
</code></pre>

    <blockquote>
        OczywiÅ›cie nie jest to najpiÄ™kniejsza ani nawet najbardziej poprawna forma. Normalnie komenda CLI nie zawieraÅ‚aby
        definicji <code>pipeline'u ETL</code>, jednak na potrzeby przykÅ‚adu jest to dobry start.
    </blockquote>

    <p>
        Dedykowany centralny magazyn danych, to niewÄ…tpliwie kuszÄ…ca opcja, szczegÃ³lnie w miejscach
        gdzie brak widocznoÅ›ci uniemoÅ¼liwia sprawne podejmowanie decyzji.
    </p>
    <p>
        Na szczÄ™scie jest to ten rodzaj funkcjonalnoÅ›ci, ktÃ³rÄ… moÅ¼na doÅ‚ozyÄ‡ w zasadzie na kaÅ¼dym etapie Å¼ycia projektu.
    </p>
    <p>
        MoÅ¼e wymagaÄ‡ wprowadzenia dodatkowych procesÃ³w oraz pewnej dyscypliny od zespoÅ‚Ã³w, jednak korzyÅ›ci pÅ‚ynÄ…ce z takiego rozwiÄ…zania sÄ… ogromne.
    </p>
    <ul>
        <li>Nie ma obawy o to, Å¼e analityka wpÅ‚ynie na pracÄ™ systemu</li>
        <li>Mamy dostÄ™p do wszystkich zakamarkÃ³w naszego systemu, kaÅ¼dego mikroserwisu czy moduÅ‚u</li>
        <li>Taka centralna baza danych to najlepszy prezent dla analitykÃ³w</li>
        <li>Data Science nie polega juÅ¼ na przepalaniu czasu na oczyszczanie danych</li>
        <li>MoÅ¼emy Å‚atwo i bezpiecznie podpiÄ…Ä‡ w zasadzie dowolne narzÄ™dzia typu Business Intelligence</li>
        <li>Tworzymy kulturÄ™ pracy z danymi w ramach naszej organizacji</li>
    </ul>
    <p>
        OczywiÅ›cie jak wszystko co nowe, takie zmiany mogÄ… wyglÄ…daÄ‡ na trudne do wprowadzenia.
        Brak doÅ›wiadczenia w pracy z danymi przynajmniej na poczÄ…tkowych etapach sprawia, Å¼e zadanie to moÅ¼e wydawaÄ‡
        siÄ™ wrÄ™cz niewykonalne.
    </p>
    <p>
        Z mojego doÅ›wiadczenia wynika jednak, Å¼e najtrudniej jest zaczÄ…Ä‡, kiedy mamy juÅ¼:
    </p>
    <ul>
        <li>Kilka pierwszych <code>Pipeline'Ã³w</code> przetwarzajÄ…cych dane</li>
        <li>Kilka lub kilkanaÅ›cie schematÃ³w naszych danych</li>
        <li>JakieÅ› bardziej zÅ‚oÅ¼one transformacje</li>
        <li>Przygotowane testy</li>
        <li>Ustalone procesy i procedury</li>
    </ul>
    <p>
        Praca idzie wrÄ™cz maszynowo.
    </p>
    <p>
        Warto jednak pamiÄ™taÄ‡, Å¼e nie ma jednego uniwersalnego rozwiÄ…zania, ktÃ³re bÄ™dzie pasowaÄ‡ do kaÅ¼dego systemu.
        W kaÅ¼dym przypadku naleÅ¼y dostosowaÄ‡ podejÅ›cie do specyfiki danego systemu i organizacji.
    </p>

    <h2>Jak zaczÄ…Ä‡?</h2>
    <p>
        JeÅ›li potrzebujesz pomocy w zakresie budowy centralnego magazynu danych, chÄ™tnie Ci pomogÄ™.<br/>
        <a href="https://norbert.tech/consulting">Skontaktuj siÄ™ ze mnÄ…</a>, a wspÃ³lnie stworzymy rozwiÄ…zanie, ktÃ³re bÄ™dzie idealnie dopasowane do Twoich potrzeb.
    </p>
    <p>
        ZachÄ™cam rÃ³wnieÅ¼ do odwiedzenia serwera <a href="https://discord.gg/5dNXfQyACW" target="_blank">Discord - Flow PHP</a>, na ktÃ³rym
        moÅ¼emy porozmawiaÄ‡ bezpoÅ›rednio.
    </p>
    <div class="img-wide">
        <img src="https://norbert.tech/assets/images/blog/analytics-in-transactional-distributed-systems/consulting_01-fa277dfb3736a033cbfcf1ac931afb08.jpg" alt="Konsultacje" />
    </div>

    </article>
    <div class="mb-2 mx-auto max-w-screen-lg text-center">
        <script src="https://giscus.app/client.js"
                data-repo="norberttech/norbert.tech"
                data-repo-id="MDEwOlJlcG9zaXRvcnkyMjQ0MDQwNDA="
                data-category="Comments"
                data-category-id="DIC_kwDODWAiSM4CionD"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="0"
                data-emit-metadata="0"
                data-input-position="bottom"
                data-theme="light"
                data-lang="en"
                crossorigin="anonymous"
                async>
        </script>
    </div>
    </main>

    <footer class="p-4 bg-sky-50 absolute bottom-0 w-full">
        <div class="mx-auto max-w-screen-2xl text-center">
            <a href="/">by @norbert_tech</a>
        </div>
    </footer>
</body>
</html>