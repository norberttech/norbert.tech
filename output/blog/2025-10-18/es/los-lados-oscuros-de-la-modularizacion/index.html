<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Los Lados Oscuros de la Modularizaci贸n</title>
    <meta property="og:title" content="Los Lados Oscuros de la Modularizaci贸n" />
    <meta name="twitter:title" content="Los Lados Oscuros de la Modularizaci贸n" >

    <meta name="description" content="Desaf铆os pr谩cticos de la modularizaci贸n de sistemas - c贸mo resolver el acoplamiento a nivel de base de datos al extraer un m贸dulo de un monolito. Comparaci贸n de enfoques: separaci贸n de responsabilidades, proyecciones, eventos an茅micos y vistas materializadas.">
    <meta property="og:description" content="Desaf铆os pr谩cticos de la modularizaci贸n de sistemas - c贸mo resolver el acoplamiento a nivel de base de datos al extraer un m贸dulo de un monolito. Comparaci贸n de enfoques: separaci贸n de responsabilidades, proyecciones, eventos an茅micos y vistas materializadas.">
    <meta name="twitter:description" content="Desaf铆os pr谩cticos de la modularizaci贸n de sistemas - c贸mo resolver el acoplamiento a nivel de base de datos al extraer un m贸dulo de un monolito. Comparaci贸n de enfoques: separaci贸n de responsabilidades, proyecciones, eventos an茅micos y vistas materializadas.">

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://norbert.tech/blog/2025-10-18/es/los-lados-oscuros-de-la-modularizacion" />
                <meta property="og:image" content="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/roots-d63d84b2112026c791f0e48ba6e6d937.jpg" />
                    
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://norbert.tech/blog/2025-10-18/es/los-lados-oscuros-de-la-modularizacion" />
            <meta name="twitter:image" content="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/roots-d63d84b2112026c791f0e48ba6e6d937.jpg">
        <meta name="twitter:site" content="@norbert_tech" />
    <meta name="twitter:creator" content="@norbert_tech" />

    <link rel="apple-touch-icon" sizes="180x180" href="https://norbert.tech/assets/images/favicons/apple-touch-icon-9cae7ee880b4fe0bd755d300e1bca71e.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://norbert.tech/assets/images/favicons/favicon-32x32-b7a4ad4b584ab95534144e071f0e8587.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://norbert.tech/assets/images/favicons/favicon-16x16-154ca21abc06ae116c8d7ffc5713c000.png">
    <link rel="shortcut icon" href="https://norbert.tech/assets/images/favicons/favicon-db409885df78dea389e6d0b036da382c.ico">

            <style>
            @import url('https://fonts.googleapis.com/css2?family=Cabin:ital,wght@0,400..700;1,400..700&display=swap');
        </style>
        <link rel="stylesheet" href="https://norbert.tech/assets/styles/app-ff31265a811feebd3b3b45d8dc315d8b.css">
    
            
<script type="importmap">
{
    "imports": {
        "app": "https://norbert.tech/assets/app-930adf3462cf9ab60908eb1b74cf7ca7.js",
        "@oddbird/popover-polyfill": "https://norbert.tech/assets/vendor/@oddbird/popover-polyfill/popover-polyfill.index-7979d53637476aa204f709644aed2c19.js",
        "https://norbert.tech/assets/bootstrap.js": "https://norbert.tech/assets/bootstrap-d78d7e12c819dedf89372fb4824c072d.js",
        "htmx.org": "https://norbert.tech/assets/vendor/htmx.org/htmx.org.index-023ae86a082913526422a6063298f898.js",
        "iconify-icon": "https://norbert.tech/assets/vendor/iconify-icon/iconify-icon.index-8a41e423576dc2d752509fd455f508c1.js",
        "@symfony/stimulus-bundle": "https://norbert.tech/assets/@symfony/stimulus-bundle/loader-5751ad1ee2975e725a94d8121d153d17.js",
        "@hotwired/stimulus": "https://norbert.tech/assets/vendor/@hotwired/stimulus/stimulus.index-304681764684182e6662e0931532ed91.js",
        "https://norbert.tech/assets/@symfony/stimulus-bundle/controllers.js": "https://norbert.tech/assets/@symfony/stimulus-bundle/controllers-11c35dc7f11bbd855b8108888f18f9b7.js",
        "https://norbert.tech/assets/controllers/hello_controller.js": "https://norbert.tech/assets/controllers/hello_controller-55882fcad241d2bea50276ea485583bc.js",
        "https://norbert.tech/assets/controllers/syntax_highlight_controller.js": "https://norbert.tech/assets/controllers/syntax_highlight_controller-ae10e4cee8b4dedbf232536d05654062.js",
        "https://norbert.tech/assets/controllers/clipboard_controller.js": "https://norbert.tech/assets/controllers/clipboard_controller-6aefa8a9dec3271dae2f05b464bf9204.js",
        "highlight.js/lib/core": "https://norbert.tech/assets/vendor/highlight.js/lib/core-760145ef158caabe84ca07686407d093.js",
        "highlight.js/lib/languages/php": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/php-c0eb2105c14097e8a5a1e9a767e8ac95.js",
        "highlight.js/styles/github-dark.min.css": "data:application/javascript,document.head.appendChild%28Object.assign%28document.createElement%28%22link%22%29%2C%7Brel%3A%22stylesheet%22%2Chref%3A%22https%3A%2F%2Fnorbert.tech%2Fassets%2Fvendor%2Fhighlight.js%2Fstyles%2Fgithub-dark.min-4b46e20f66f76e35d6454ca4f09b57c3.css%22%7D%29%29",
        "@fontsource-variable/cabin/index.min.css": "data:application/javascript,document.head.appendChild%28Object.assign%28document.createElement%28%22link%22%29%2C%7Brel%3A%22stylesheet%22%2Chref%3A%22https%3A%2F%2Fnorbert.tech%2Fassets%2Fvendor%2F%40fontsource-variable%2Fcabin%2Findex.min-08e34691d22388e6974e6cb2bfbcbfd0.css%22%7D%29%29",
        "clipboard": "https://norbert.tech/assets/vendor/clipboard/clipboard.index-925566f98181665b5a61fea1bcd9033d.js",
        "highlight.js/lib/languages/shell": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/shell-664215791af27581e04813723523a355.js",
        "highlight.js/lib/languages/json": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/json-9ac51ad2a97f9ce56b2f309eb64d7b04.js",
        "highlight.js/lib/languages/twig": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/twig-0f3c6d18c0368650898b432b7bcf672a.js",
        "highlight.js/lib/languages/sql": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/sql-09f80640dd6fe9bed6ff4eb255b13f08.js",
        "highlight.js/lib/languages/javascript": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/javascript-100f963be02a503f0531e497103ff398.js",
        "highlight.js/lib/languages/xml": "https://norbert.tech/assets/vendor/highlight.js/lib/languages/xml-a2295112e12d4d01f257d59e1cfa676d.js"
    }
}
</script>
<!-- ES Module Shims: Import maps polyfill for modules browsers without import maps support -->
<script async src="https://ga.jspm.io/npm:es-module-shims@1.10.0/dist/es-module-shims.js"></script>
<link rel="modulepreload" href="https://norbert.tech/assets/app-930adf3462cf9ab60908eb1b74cf7ca7.js">
<link rel="modulepreload" href="https://norbert.tech/assets/vendor/@oddbird/popover-polyfill/popover-polyfill.index-7979d53637476aa204f709644aed2c19.js">
<link rel="modulepreload" href="https://norbert.tech/assets/bootstrap-d78d7e12c819dedf89372fb4824c072d.js">
<link rel="modulepreload" href="https://norbert.tech/assets/vendor/htmx.org/htmx.org.index-023ae86a082913526422a6063298f898.js">
<link rel="modulepreload" href="https://norbert.tech/assets/vendor/iconify-icon/iconify-icon.index-8a41e423576dc2d752509fd455f508c1.js">
<link rel="modulepreload" href="https://norbert.tech/assets/@symfony/stimulus-bundle/loader-5751ad1ee2975e725a94d8121d153d17.js">
<link rel="modulepreload" href="https://norbert.tech/assets/vendor/@hotwired/stimulus/stimulus.index-304681764684182e6662e0931532ed91.js">
<link rel="modulepreload" href="https://norbert.tech/assets/@symfony/stimulus-bundle/controllers-11c35dc7f11bbd855b8108888f18f9b7.js">
<link rel="modulepreload" href="https://norbert.tech/assets/controllers/hello_controller-55882fcad241d2bea50276ea485583bc.js">
<script type="module">import 'app';</script>
                <script defer src="https://cloud.umami.is/script.js" data-website-id="9fed007d-d990-428b-b5d9-11c6ff55a3f1"></script>
    </head>
<body class="scroll-smooth text-black relative min-h-screen pb-16">
    <div class="sticky top-0 max-h-screen overflow-y-auto bg-white py-2 px-2 border-b border-gray-500 z-[9999] print:hidden">
        <div class="grid grid-cols-2 sm:mx-auto sm:max-w-screen-2xl md:px-4">
            <div class="text-left">
                <a href="/" class="text-lg">
                    norbert.tech
                </a>
            </div>
            <div class="text-right">
                <a href="/consulting" class="text-lg inline-flex items-center space-x-1 md:mr-4 mr-2">
                    <iconify-icon icon="lineicons:consulting" class="mr-1"></iconify-icon> Consulting
                </a>
                <a href="/blog" class="text-lg inline-flex items-center space-x-1">
                    <iconify-icon icon="ooui:articles-ltr" class="mr-1"></iconify-icon> Blog
                </a>
            </div>
        </div>
    </div>
    
    <main class="mx-auto max-w-screen-2xl mb-4 md:pt-4 px-4 lg:px-0">
            <div class="px-2 py-5 sm:px-4 md:px-8 lg:px-12 mx-auto max-w-4xl">
        <ul class="mt-2 pl-[20px] flex flex-wrap gap-2 sm:gap-4">
            <li>
                <a href="/blog" class="text-sm sm:text-base text-blue-500 hover:underline px-2 py-1 rounded">Go Back</a>
            </li>
                                                                <li>
                        <a href="/blog/2025-10-18/pl/mroczne-strony-modularyzacji"
                           class="text-sm sm:text-lg px-2 py-1 rounded hover:opacity-80"
                           title="Polish">叼 Polish</a>
                    </li>
                                                                                <li>
                        <a href="/blog/2025-10-18/dark-sides-of-modularization"
                           class="text-sm sm:text-lg px-2 py-1 rounded hover:opacity-80"
                           title="English">吼 English</a>
                    </li>
                                                                                <li>
                        <a href="/blog/2025-10-18/de/die-dunklen-seiten-der-modularisierung"
                           class="text-sm sm:text-lg px-2 py-1 rounded hover:opacity-80"
                           title="Deutsch"> Deutsch</a>
                    </li>
                                                                                <li>
                        <a href="/blog/2025-10-18/fr/les-cotes-sombres-de-la-modularisation"
                           class="text-sm sm:text-lg px-2 py-1 rounded hover:opacity-80"
                           title="French"> French</a>
                    </li>
                                                                                <li>
                        <a href="/blog/2025-10-18/it/i-lati-oscuri-della-modularizzazione"
                           class="text-sm sm:text-lg px-2 py-1 rounded hover:opacity-80"
                           title="Italian"> Italian</a>
                    </li>
                                    </ul>

                    <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="font-medium text-yellow-800">
                            Translation Notice
                        </h3>
                        <div class="mt-2 text-yellow-700">
                            <p>
                                This is an automatically translated version of that Article. Despite my best efforts, it might not be perfect.<br/>
                                Native speakers are welcome to
                                <a href="https://github.com/norberttech/norbert.tech/edit/main/templates/blog/posts/2025-10-18/los-lados-oscuros-de-la-modularizacion/post.html.twig"
                                   class="underline hover:text-yellow-800" target="_blank" rel="noopener">open pull requests
                                </a> to correct anything that doesn't sound right.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            </div>
    <article class="blog-post">
            <div class="img-wide">
        <img src="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/roots-d63d84b2112026c791f0e48ba6e6d937.jpg" alt="Los Lados Oscuros de la Modularizaci贸n" />
    </div>

    <h1 class="font-bold text-4xl mb-2" id="title">Los Lados Oscuros de la Modularizaci贸n</h1>
    <div class="mb-2">
        <small class="text-sm">Publicado el October 18, 2025 00:00</small>
    </div>
    <div class="mb-4">
                    <small><span class="badge badge-info">modularizaci贸n</span></small>
                    <small><span class="badge badge-info">arquitectura</span></small>
                    <small><span class="badge badge-info">desarrollo de software</span></small>
            </div>

    <a href="#introduction"><h2 id="introduction">Introducci贸n</h2></a>
    <p>
        Hace poco me top茅 con un problema bastante interesante que me hizo reflexionar sobre los aspectos menos glamorosos
        de la modularizaci贸n - ya sabes, esas cosas de las que normalmente no hablamos en conferencias o talleres.
    </p>
    <p>
        Empecemos por lo b谩sico. 驴Qu茅 es exactamente la modularizaci贸n? En pocas palabras, es dividir
        un sistema en partes independientes (m贸dulos), donde cada uno tiene:
    </p>
    <ul>
        <li>Una responsabilidad claramente definida</li>
        <li>Comunicaci贸n a trav茅s de protocolos definidos</li>
        <li>La capacidad de desarrollarse independientemente de otros m贸dulos</li>
    </ul>
    <p>
        En resumen, es un gui帽o al principio de <strong>divide y vencer谩s</strong>. En lugar de luchar
        con un problema enorme, complicado y enredado, lo dividimos en problemas m谩s peque帽os que son mucho m谩s f谩ciles
        de resolver.
    </p>

    <p>
        Mucha gente escucha "modularizaci贸n" y piensa inmediatamente en "microservicios". As铆 que antes de continuar, aclaremos algo.
        Los microservicios son solo una forma de implementar la modularizaci贸n, al igual que un monolito modular.
    </p>

    <a href="#current-state"><h2 id="current-state">El Estado Actual</h2></a>

    <p>
        Imagina un sistema compuesto por tres m贸dulos.
    </p>
    <div class="notice">
        <p>
            <strong>Nota:</strong> El diagrama a continuaci贸n es un modelo muy simplificado - su 煤nico prop贸sito es
            ilustrar el problema.
        </p>
    </div>
    <ul>
        <li>M贸dulo <code>IAM</code> (Identity and Access) - usuarios / grupos / permisos</li>
        <li><code>M贸dulo A</code> - gesti贸n de recursos</li>
        <li><code>M贸dulo B</code> - gesti贸n de otros recursos</li>
    </ul>

    <div class="img-wide">
        <a href="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/problem-2933ef78ce8a272ce5278e05d2779739.png" target="_blank">
            <img src="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/problem-2933ef78ce8a272ce5278e05d2779739.png" alt="Los Lados Oscuros de la Modularizaci贸n - problema" />
        </a>
    </div>

    <p>
        El sistema de permisos aqu铆 es un poco complejo. Se basa principalmente en <code>ACL</code> (Access Control List),
        lo que significa otorgar permisos a recursos directamente a usuarios o grupos.
    </p>
    <p>
        Adem谩s, tambi茅n hay algo de <code>RBAC</code> (Role Based Access Control), donde los usuarios con
        roles espec铆ficos tienen permisos definidos para partes espec铆ficas del sistema.
    </p>
    <p>
        Tambi茅n tenemos parcialmente <code>ABAC</code> (Attribute Based Access Control), donde los permisos se derivan de atributos del usuario,
        en este caso, la pertenencia a grupos.
    </p>
    <p>
        驴Te suena familiar? Este no es un caso tan 煤nico como podr铆as pensar. Pero en fin, vayamos al grano.
    </p>
    <a href="#problem"><h2 id="problem">El Problema</h2></a>
    <p>
        Como puedes ver en el diagrama, el sistema de permisos est谩 definido en el m贸dulo <code>IAM</code> - ah铆 es donde almacenamos
        informaci贸n sobre:
    </p>
    <ul>
        <li>Usuarios y sus roles</li>
        <li>Grupos a los que pertenecen los usuarios</li>
        <li>Permisos para recursos espec铆ficos</li>
    </ul>
    <p>
        Los m贸dulos A y B, mientras tanto, son responsables de gestionar sus propios recursos, pero necesitan verificar
        que un usuario determinado tenga acceso a un recurso espec铆fico.
    </p>
    <p>
        As铆 que el esquema de dependencias de m贸dulos se ve as铆: Los m贸dulos A y B saben de la existencia del m贸dulo IAM (dependen
        de 茅l), pero el m贸dulo IAM en s铆 no tiene idea de que existen los m贸dulos A y B.
    </p>
    <div class="img-wide">
        <a href="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/dependencies-e3b2cbdaf7b55733aa258cc8fd2665e7.png" target="_blank">
            <img src="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/dependencies-e3b2cbdaf7b55733aa258cc8fd2665e7.png" alt="Los Lados Oscuros de la Modularizaci贸n - Dependencias" />
        </a>
    </div>
    <p>
        El problema con el que se encontr贸 el equipo fue este: "驴C贸mo creamos una lista paginada de recursos en un m贸dulo determinado basada en permisos de usuario?"
    </p>
    <p>
        Adem谩s, la lista de recursos necesita permitir:
    </p>
    <ul>
        <li>Filtrado basado en caracter铆sticas del recurso</li>
        <li>Ordenaci贸n basada en caracter铆sticas del recurso</li>
        <li>Devolver solo una p谩gina seleccionada</li>
    </ul>
    <p>
        Estos requisitos hacen que la implementaci贸n sea significativamente m谩s dif铆cil. Si no tuvi茅ramos filtrado/paginaci贸n, podr铆amos simplemente
        consultar directamente al m贸dulo <code>IAM</code> con una solicitud para devolver recursos para un usuario determinado.
    </p>
    <div class="important">
        <p>
            Las caracter铆sticas del recurso son todos sus par谩metros y atributos que tienen sentido y significado principalmente dentro de su
            propio contexto. Ejemplos de caracter铆sticas del recurso podr铆an ser su nombre o fecha de creaci贸n. Estos son par谩metros por los que
            el usuario deber铆a poder ordenar o filtrar, pero que no existen en el m贸dulo <code>IAM</code>.
        </p>
    </div>
    <p>
        Pero sin caracter铆sticas del recurso por las que podamos filtrar/ordenar, el m贸dulo <code>IAM</code> puede, en el mejor de los casos, devolver todos los recursos,
        y tendr铆amos que hacer el filtrado en el lado del m贸dulo. No es exactamente una soluci贸n escalable.
    </p>
    <p>
        Sin saber c贸mo salir de esta situaci贸n, el equipo decidi贸 (consciente o inconscientemente) romper las reglas de modularizaci贸n y acoplar
        los m贸dulos a nivel de base de datos.
    </p>
    <p>
        Dado que el sistema est谩 desplegado como un monolito modular y cada m贸dulo tiene acceso a la misma base de datos (cada m贸dulo tiene sus propias tablas con un prefijo apropiado),
        te贸ricamente nada impide construir una consulta SQL que devuelva una lista de recursos para un m贸dulo espec铆fico
        y unirla con las tablas de permisos del m贸dulo <code>IAM</code> para filtrar los recursos a los que el usuario no tiene acceso.
    </p>
    <p>
        R谩pido, simple y hasta funciona.
    </p>
    <p>
        Esto probablemente podr铆a coexistir pac铆ficamente, excepto por un nuevo requisito: necesitamos extraer uno de los m贸dulos del
        monolito...
    </p>
    <p>
        Y aqu铆 es donde las cosas se complican. 驴C贸mo extraes el M贸dulo A como un servicio independiente cuando est谩 estrechamente acoplado a nivel de
        base de datos con el m贸dulo IAM? Si eliminamos el <code>join</code> a las tablas de <code>IAM</code>, el control de acceso
        dejar谩 de funcionar.
    </p>
    <p>
        A continuaci贸n, presentar茅 t茅cnicas que nos permitir谩n extraer este m贸dulo del monolito sin perder funcionalidad, romper
        las reglas de modularizaci贸n o cambiar las dependencias entre m贸dulos.
    </p>
    <div class="notice">
        <p>
            Al dise帽ar un monolito modular, vale la pena intentar un enfoque ligeramente diferente.
            En lugar de prefijar tablas, puedes crear bases de datos/esquemas separados para cada m贸dulo dentro de un 煤nico servidor de base de datos,
            lo que hace mucho m谩s dif铆cil crear un acoplamiento accidental a nivel de consulta SQL.
        </p>
    </div>
    <a href="#division-of-responsibility"><h2 id="division-of-responsibility">Divisi贸n de Responsabilidades</h2></a>
    <p>
        驴Y si no fuera el m贸dulo <code>IAM</code> el responsable de los permisos otorgados a recursos
        que solo existen en un m贸dulo espec铆fico?
    </p>
    <p>
        Un enfoque posible (probablemente el mejor para muchos) es la separaci贸n de responsabilidades, lo que significa que <code>IAM</code>
        maneja la autorizaci贸n, usuarios, sus roles y los grupos a los que est谩n asignados.
    </p>
    <p>
        Los m贸dulos mismos gestionan las reglas de permisos para recursos. En la pr谩ctica, esto significa mover las tablas <code>access_rules</code>
        al <code>M贸dulo A</code> y al <code>M贸dulo B</code>.
    </p>
    <p>
        El resultado ser铆a una arquitectura similar a la siguiente:
    </p>
    <div class="img-wide">
        <a href="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/separation-0a5d845d328a2a164afabebd94ee165c.png" target="_blank">
            <img src="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/separation-0a5d845d328a2a164afabebd94ee165c.png" alt="Los Lados Oscuros de la Modularizaci贸n - Separaci贸n" />
        </a>
    </div>
    <p>
        Ninguno de los m贸dulos necesita hacer viajes a <code>IAM</code> para obtener una lista de recursos disponibles
        para un usuario seleccionado.
    </p>
    <p>
        S铆 tenemos algo de duplicaci贸n - b谩sicamente necesitamos repetir la l贸gica de permisos para cada m贸dulo existente
        e integrarla en los mecanismos de m贸dulo existentes.
    </p>
    <div class="notice">
        <p>
            <strong>Nota:</strong> Aqu铆 podr铆as sentir la tentaci贸n de crear un componente.
            A menos que tengas personas en tus equipos con experiencia en la construcci贸n de bibliotecas/componentes, es mejor comenzar
            con duplicaci贸n. A largo plazo, la duplicaci贸n duele mucho menos que la abstracci贸n incorrecta.
        </p>
    </div>
    <p>
        驴Pero es eso suficiente?
    </p>
    <p>
        No del todo. Si miramos la tabla de permisos, notaremos que los permisos pueden otorgarse directamente
        a un usuario o a un grupo al que pertenece el usuario.
    </p>
    <p>
        Esto significa que en el <code>M贸dulo A</code>, otorgamos permisos a un recurso para el grupo <code>Grupo 01</code>, que incluye
        al <code>Usuario 01</code> y al <code>Usuario 02</code>.<br/>
        Gracias a esto, ambos usuarios tienen acceso al recurso.
    </p>
    <p>
        驴Pero qu茅 pasa si eliminamos un usuario del grupo seleccionado?
    </p>
    <p>
        Podemos abordar esto de dos maneras:
    </p>
    <ol>
        <li>Durante cada verificaci贸n de acceso, consultamos al m贸dulo <code>IAM</code> por la lista de grupos del usuario</li>
        <li>Aceptamos la <code>consistencia eventual</code> y mantenemos los grupos de usuario en la sesi贸n, refresc谩ndola cada pocos/varios minutos</li>
    </ol>

    <p>
        La primera soluci贸n es la m谩s simple de implementar, no viola los l铆mites de responsabilidad del m贸dulo, pero podr铆a
        convertirse en un cuello de botella bastante r谩pido.
    </p>
    <p>
        Por supuesto, esto no suceder谩 de inmediato. Adem谩s, debido a la naturaleza de los datos (m谩s lecturas que escrituras), tambi茅n podemos
        descargar la base de datos a trav茅s de mecanismos de cach茅 apropiados.
    </p>
    <p>
        Para la soluci贸n n煤mero dos, necesitamos asegurarnos de que sea siquiera una soluci贸n aceptable desde la perspectiva del
        negocio.
    </p>
    <a href="#projection"><h2 id="projection">Proyecci贸n</h2></a>
    <p>
        Otro enfoque para resolver el problema es mantener la estructura de permisos en el m贸dulo <code>IAM</code>, pero
        introducir mecanismos que permitan al <code>M贸dulo A</code> y al <code>M贸dulo B</code> sincronizar
        la tabla de permisos con una proyecci贸n local.
    </p>
    <p>
        Esta proyecci贸n no es m谩s que una forma simplificada de la tabla <code>access_rules</code> replicada en un m贸dulo espec铆fico.
    </p>
    <p>
        Como resultado, todav铆a obtenemos algo de duplicaci贸n, pero el <code>M贸dulo A</code> y el <code>M贸dulo B</code>
        no se centran en gestionar permisos - esa responsabilidad sigue delegada al m贸dulo <code>IAM</code>.
    </p>
    <p>
        Su responsabilidad se reduce a sincronizar permisos con el m贸dulo de permisos.
    </p>
    <p>
        Pero 驴c贸mo y cu谩ndo realizamos esta sincronizaci贸n? Cada vez que otorgamos permisos a un recurso.
    </p>
    <p>
        El <code>M贸dulo A</code>, al otorgar permisos a un usuario o grupo para alg煤n recurso, primero
        se comunica con el m贸dulo <code>IAM</code>.
    </p>
    <p>
        Hacemos lo mismo al revocar el acceso a un recurso. Primero eliminamos la entrada en el m贸dulo <code>IAM</code>, luego
        eliminamos la entrada en la proyecci贸n local.
    </p>
    <p>
        驴Pero qu茅 pasa si eliminamos un usuario de un grupo seleccionado?
    </p>
    <p>
        Aqu铆 b谩sicamente volvemos al mismo problema que ten铆amos en el enfoque anterior. Podemos
        obtener la lista de grupos del usuario del m贸dulo <code>IAM</code> cada vez, o aceptar la consistencia eventual.
    </p>
    <p>
        La diferencia entre separaci贸n y proyecci贸n es muy peque帽a. Pero con proyecciones, podemos ir un paso m谩s all谩.
    </p>
    <a href="#events"><h2 id="events">Eventos</h2></a>
    <p>
        El m贸dulo <code>IAM</code> tambi茅n puede propagar eventos relacionados con:
    </p>
    <ul>
        <li>Agregar un usuario a grupos</li>
        <li>Eliminar un usuario de un grupo</li>
        <li>Eliminar un grupo</li>
    </ul>
    <p>
        Para mantener la estructura de dependencia adecuada, estos eventos no pueden publicarse "a un destinatario espec铆fico".
        Necesitamos aplicar un enfoque Pub/Sub aqu铆, donde <code>IAM</code> publica eventos a un
        <code>Topic</code> espec铆fico, al que los m贸dulos interesados pueden suscribirse.
    </p>
    <p>
        Gracias a esto, ambos m贸dulos recibir谩n una copia del mismo evento, que pueden manejar independientemente.
    </p>
    <p>
        Al construir una proyecci贸n, tambi茅n podemos simplificar significativamente su estructura dividiendo grupos en listas de usuarios.
    </p>
    <p>
        Si un grupo recibe permiso de <code>acceso</code> a alg煤n recurso, en lugar de almacenar
        una entrada en la proyecci贸n que represente al grupo, podemos crear una entrada para cada usuario del grupo.
    </p>
    <p>
        Gracias a esto, durante la verificaci贸n de acceso, no necesitamos preguntar al m贸dulo <code>IAM</code> por nada en absoluto. Solo necesitamos
        responder apropiadamente a los eventos propagados por el m贸dulo <code>IAM</code>:
    </p>
    <ul>
        <li>Agregar un usuario a un grupo</li>
        <li>Eliminar un usuario de un grupo</li>
        <li>Eliminar un grupo</li>
    </ul>
    <p>
        B谩sicamente, solo estos eventos nos importan. Agregar un grupo o usuario en realidad no afecta nada,
        as铆 que podemos ignorarlos/filtrarlos de forma segura.
    </p>
    <a href="#events-reliability"><h2 id="events-reliability">Fiabilidad de Eventos</h2></a>
    <p>
        Por supuesto, un enfoque basado en eventos conlleva ciertos riesgos. Uno de ellos es, por ejemplo, el orden de eventos interrumpido.<br/>
        Por ejemplo, primero recibimos un evento de "usuario eliminado del grupo", y solo despu茅s el evento de "usuario agregado", cuando
        en realidad estos eventos ocurrieron en el orden opuesto.
    </p>
    <p>
        S铆, esto puede ser un problema, especialmente cuando el mensaje que contiene el evento tambi茅n incluye
        todos los detalles de ese evento.
    </p>
    <p>
        Pero podemos lidiar con esto decidiendo usar eventos an茅micos - es decir, eventos que b谩sicamente
        solo contienen identificadores de los recursos a los que conciernen, y para todo lo dem谩s necesitas ir al m贸dulo fuente.
    </p>
    <p>
        Comparemos ambos enfoques usando el evento <code>UserRemovedFromGroup</code> como ejemplo:
    </p>

    <p><strong>Evento Rico (Rich Event)</strong></p>
    <pre><code class="language-json" data-controller="syntax-highlight">{
  &quot;eventId&quot;: &quot;550e8400-e29b-41d4-a716-446655440000&quot;,
  &quot;eventType&quot;: &quot;UserRemovedFromGroup&quot;,
  &quot;occurredAt&quot;: &quot;2025-10-18T10:30:00Z&quot;,
  &quot;payload&quot;: {
    &quot;userId&quot;: 123,
    &quot;userName&quot;: &quot;jan.kowalski&quot;,
    &quot;userEmail&quot;: &quot;jan.kowalski@example.com&quot;,
    &quot;groupId&quot;: 456,
    &quot;groupName&quot;: &quot;Administrators&quot;,
    &quot;groupPermissions&quot;: [&quot;read&quot;, &quot;write&quot;, &quot;delete&quot;],
    &quot;removedBy&quot;: {
      &quot;userId&quot;: 789,
      &quot;userName&quot;: &quot;admin&quot;
    }
  }
}
</code></pre>

    <p><strong>Evento An茅mico (Anemic Event)</strong></p>
    <pre><code class="language-json" data-controller="syntax-highlight">{
  &quot;eventId&quot;: &quot;550e8400-e29b-41d4-a716-446655440000&quot;,
  &quot;eventType&quot;: &quot;UserRemovedFromGroup&quot;,
  &quot;occurredAt&quot;: &quot;2025-10-18T10:30:00Z&quot;,
  &quot;payload&quot;: {
    &quot;userId&quot;: 123,
    &quot;groupId&quot;: 456
  }
}
</code></pre>

    <p>
        La diferencia es fundamental. Con un evento rico, toda la informaci贸n sobre el usuario, el grupo y los permisos
        est谩 contenida en el evento. Si el orden de los eventos se interrumpe, nuestra proyecci贸n puede terminar en un estado inconsistente.
    </p>
    <p>
        Un evento an茅mico, por otro lado, solo contiene identificadores. Despu茅s de recibir tal evento, el consumidor debe
        hacer una consulta adicional al m贸dulo <code>IAM</code> para obtener el estado actual. Gracias a esto, independientemente del orden
        en que se reciban los eventos, siempre obtendremos la versi贸n m谩s actualizada de los datos.
    </p>

    <p><strong>Escenario Problem谩tico para Eventos Ricos</strong></p>
    <p>
        Imaginemos la siguiente secuencia de eventos en el m贸dulo <code>IAM</code>:
    </p>
    <ol>
        <li><code>10:00:00</code> - Usuario agregado al grupo "Administrators"</li>
        <li><code>10:00:05</code> - Usuario eliminado del grupo "Administrators"</li>
    </ol>
    <p>
        El consumidor en el M贸dulo A recibe eventos en orden inverso:
    </p>
    <ol>
        <li>Recibe <code>UserRemovedFromGroup</code> (con datos de 10:00:05)</li>
        <li>Recibe <code>UserAddedToGroup</code> (con datos de 10:00:00)</li>
    </ol>
    <p>
        Con <strong>eventos ricos</strong>, la proyecci贸n en el M贸dulo A muestra que el usuario <strong>pertenece</strong>
        al grupo (porque el 煤ltimo evento recibido fue "adici贸n"), aunque en realidad ya ha sido eliminado de 茅l.
    </p>
    <p>
        Con <strong>eventos an茅micos</strong>, independientemente del orden recibido, el M贸dulo A ejecutar谩 una consulta a IAM
        y obtendr谩 el estado actual - el usuario <strong>no pertenece</strong> al grupo.
    </p>

    <div class="notice">
        <p>
            Los eventos an茅micos reducen el riesgo de inconsistencia, pero no lo eliminan por completo.
            Todav铆a existe la posibilidad de que entre recibir el evento y consultar a IAM,
            el estado cambie. As铆 que podr铆as considerar agregar un n煤mero de versi贸n o marca de tiempo
            a los eventos y verificarlos al actualizar la proyecci贸n. Aunque los mecanismos de protecci贸n
            depender谩n en gran medida del tr谩fico y la frecuencia de cambios.
        </p>
    </div>

    <p>
        As铆 es como se ve:
    </p>
    <div class="img-wide">
        <a href="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/events-a4cab163fdacfd0b1ae2042e81cf2e4e.png" target="_blank">
            <img src="https://norbert.tech/assets/images/blog/dark-sides-of-modularization/events-a4cab163fdacfd0b1ae2042e81cf2e4e.png" alt="Los Lados Oscuros de la Modularizaci贸n - Eventos" />
        </a>
    </div>
    <p>
        Cuando el consumidor del M贸dulo A recibe informaci贸n, su trabajo es ir al m贸dulo <code>IAM</code> y preguntarle
        por todas las reglas para un grupo espec铆fico. El m贸dulo <code>IAM</code> puede devolver registros de la tabla de permisos concernientes a
        un grupo espec铆fico, y luego, si existen reglas, podemos preguntar por los usuarios de ese grupo y en
        la proyecci贸n local del m贸dulo construir una proyecci贸n de permisos para ellos.
    </p>
    <p>
        Tambi茅n podemos facilitarnos un poco la vida y agregar al protocolo de comunicaci贸n con el m贸dulo <code>IAM</code> la capacidad de
        obtener una estructura plana de permisos, que devuelva no el grupo sino una lista de usuarios del grupo con permisos a
        un recurso espec铆fico.
    </p>
    <div class="important">
        <p>
            <strong>Nota:</strong> Para proporcionar garant铆as adicionales de entrega de eventos, considera
            implementar el patr贸n <strong>Outbox</strong>.
        </p>
    </div>
    <p>
        Espera, 驴pero no se convertir谩 el m贸dulo <code>IAM</code> en un cuello de botella otra vez?
    </p>
    <p>
        No del todo. Lo que importa aqu铆 no es solo la consulta en s铆, sino m谩s bien su frecuencia. El control de permisos es
        uno de esos procesos donde preguntamos sobre permisos con mucha m谩s frecuencia de lo que los cambiamos.
    </p>
    <p>
        Por supuesto, no me creas solo a m铆 - si tienes un sistema existente con control de permisos, vale la pena simplemente medirlo.
    </p>
    <p>
        Pero volviendo al punto, al usar eventos an茅micos, no tenemos que preocuparnos tanto por
        el orden en que se reciben. No confiamos en el contenido del evento sino solo en el identificador del recurso que
        concierne, lo que hace que construir proyecciones sea mucho m谩s f谩cil.
    </p>
    <p>
        Pero esto tiene su costo - ahora despu茅s de cada evento necesitamos ir a la fuente para
        determinar el estado real.
    </p>
    <p>
        As铆 que vale la pena analizar este enfoque desde una perspectiva de rendimiento.<br/>
        Sin embargo, hay m谩s t茅cnicas para lidiar con eventos. Puedes encontrar una en <a href="https://event-driven.io/en/dealing_with_race_conditions_in_eda_using_read_models/" target="_blank">https://event-driven.io/</a>.
    </p>
    <a href="#duplication"><h2 id="duplication">Duplicaci贸n</h2></a>
    <p>
        En ambos enfoques, sin embargo, surge el problema de la duplicaci贸n. Aunque en este caso, "problema" es probablemente la palabra equivocada.
        Es simplemente un costo de la modularizaci贸n del que simplemente no se habla.
    </p>
    <p>
        Independientemente de si decidimos la separaci贸n de responsabilidades o la construcci贸n de proyecciones, los M贸dulos A y B
        duplicar谩n la l贸gica relacionada con permisos en mayor o menor medida.
    </p>
    <p>
        As铆 que independientemente de nuestro modelo de despliegue (monolito / microservicios) e independientemente de c贸mo separemos
        los l铆mites de m贸dulos y sus responsabilidades, simplemente necesitamos prepararnos para este costo.
    </p>
    <p>
        Mi consejo aqu铆 es siempre comenzar con duplicaci贸n. Incluso si nuestras implementaciones no difieren en absoluto
        entre m贸dulos.
    </p>
    <p>
        Es mucho m谩s f谩cil extraer partes comunes de soluciones existentes que dise帽ar partes comunes para soluciones
        que a煤n no existen.
    </p>
    <a href="#whats-better"><h2 id="whats-better">驴Qu茅 es Mejor?</h2></a>
    <p>
        No hay una respuesta clara a esta pregunta. Pero podemos intentar analizar nuestra situaci贸n y elegir
        una soluci贸n que nos permita extraer uno de los m贸dulos y deshacernos del acoplamiento a nivel de base de datos.
    </p>
    <p>
        Para el m贸dulo que necesita ser extra铆do, sugerir铆a (si es posible) la separaci贸n de responsabilidades y
        mover la gesti贸n de permisos de recursos a ese m贸dulo.
    </p>
    <p>
        Ya que de todos modos tenemos que hacer algo de trabajo, ya que tenemos que separar f铆sicamente este m贸dulo de nuestro monolito,
        tambi茅n podr铆amos ir un paso m谩s all谩 y reducir su dependencia de
        <code>IAM</code> a煤n m谩s a un costo relativamente bajo.
    </p>
    <p>
        驴Pero tiene sentido tal operaci贸n para los m贸dulos existentes?
    </p>
    <p>
        Para los m贸dulos que no necesitan ser extra铆dos y continuar谩n viviendo dentro del monolito modular, sugerir铆a
        un enfoque basado en proyecci贸n, pero no necesariamente con eventos.
    </p>
    <a href="#projections-without-events"><h2 id="projections-without-events">Proyecciones Sin Eventos</h2></a>
    <div class="important">
        <p>
            Esta es una t茅cnica que no funcionar谩 en un enfoque de microservicios, pero puede ayudar como soluci贸n provisional.
            No solo ayudar, sino tambi茅n se帽alar el camino a seguir. Puedes implementarla a bajo costo, obteniendo
            b谩sicamente lo mismo que con un enfoque basado en eventos.
        </p>
    </div>
    <p>
        Mir茅moslo desde un 谩ngulo diferente. Pub/Sub es b谩sicamente un mecanismo que nos permite una cierta forma de replicaci贸n.
        Gracias a los eventos, sabemos que algo sucedi贸 en alg煤n momento en alg煤n m贸dulo.
    </p>
    <p>
        驴Qu茅 tal si en lugar de publicar un evento a un <code>Topic</code>, us谩ramos <code>Vistas Materializadas</code>?
    </p>
    <p>
        S铆, lo s茅 - mucha gente probablemente est谩 viendo banderas rojas ahora mismo. Quiero decir, 驴vistas materializadas?
        驴L贸gica en el lado de la base de datos en lugar de en el c贸digo?
    </p>
    <p>
        Bueno, no es una soluci贸n ideal. Claro, nos deshacemos del acoplamiento a nivel SQL, pero a cambio
        obtenemos un acoplamiento diferente - esta vez a nivel de base de datos.
    </p>
    <p>
        Pero si abordamos esto pragm谩ticamente, b谩sicamente solo estamos intercambiando el mecanismo de transporte.
        En lugar de construir pub/sub, implementar el patr贸n Outbox, manejar errores de comunicaci贸n de red, reintentos, etc.,
        podemos simplemente dejar que la base de datos maneje la replicaci贸n de datos.
    </p>
    <p>
        Si por alguna raz贸n esto deja de funcionarnos - como cuando actualizar la vista materializada
        se vuelve demasiado costoso y comienza a cargar innecesariamente nuestra base de datos - nada nos impedir谩
        cambiar a proyecciones.
    </p>
    <p>
        Pero antes de llegar a ese punto, tambi茅n podemos intentar poner el proceso de actualizaci贸n mismo en una cola en el m贸dulo <code>IAM</code>
        y ejecutarlo de forma as铆ncrona. Obtendremos un ligero retraso, aunque en este caso deber铆a estar en un nivel aceptable.
    </p>
    <p>
        Lo clave es entender que una <code>Vista Materializada</code> no es una soluci贸n mala ni buena - solo nos da
        la capacidad de introducir una separaci贸n simplificada relativamente r谩pido sin tener que construir todo el mecanismo basado en eventos.
    </p>
    <p>
        Pero cuando la separaci贸n completa/rendimiento/bloqueo de proveedor o cualquier otra cosa comience a molestarnos aqu铆, no deber铆a haber problemas mayores
        al cambiar a proyecciones.
    </p>
    <p>
        Eso es exactamente lo que hace que <code>Vista Materializada</code> sea una soluci贸n interesante.
    </p>
    <a href="#ideal-solution"><h2 id="ideal-solution">La Soluci贸n Ideal</h2></a>
    <p class="text-center">
        <strong>No existe...</strong>
    </p>
    <p>
        Y eso es probablemente lo m谩s importante que quiero transmitir en este art铆culo.
    </p>
    <p>
        Incluso si logramos reducir el problema puramente a tecnolog铆a, e incluso si por alg煤n milagro
        todos estamos de acuerdo en que el problema A debe resolverse con patr贸n/t茅cnica/arquitectura B...
    </p>
    <p>
        Nada de eso podr铆a importar porque el negocio simplemente podr铆a no aprobar una refactorizaci贸n importante...<br/>
        Y esto no tiene que ser mala fe o ignorancia - a veces simplemente no tenemos los recursos.
    </p>
    <p>
        Es dif铆cil justificar por qu茅 deber铆amos pasar tiempo moviendo la gesti贸n de permisos a m贸dulos
        cuando todo funciona y genera ganancias.
    </p>
    <p>
        Tan dif铆cil como ser谩 argumentar por qu茅 de repente, con un requisito de extraer un m贸dulo, tenemos que arreglar
        todos los dem谩s, agregando comunicaci贸n as铆ncrona, eventos, mecanismos de reintento, recuperaci贸n, etc.
    </p>
    <p>
        Vale la pena aceptar que el mundo no es perfecto, no es blanco y negro, y a menudo tendremos que
        elegir entre varias soluciones imperfectas.
    </p>
    <p>
        Lo que podr铆a parecer absolutamente incorrecto en un lugar podr铆a ser aceptable en otro contexto,
        o incluso deseable.
    </p>
    <a href="#help"><h2 id="help">Ayuda</h2></a>
    <p>
        Si est谩s luchando con problemas similares en tu proyecto y no est谩s muy seguro de c贸mo resolverlos,<br/>
        <a href="https://norbert.tech/consulting">ponte en contacto conmigo</a>, y juntos encontraremos una soluci贸n perfectamente adaptada a tus necesidades.
    </p>
    <p>
        Tambi茅n te animo a visitar <a href="https://discord.gg/5dNXfQyACW" target="_blank">Discord - Flow PHP</a>, donde
        podemos hablar directamente.
    </p>
    <div class="img-wide">
        <img src="https://norbert.tech/assets/images/blog/analytics-in-transactional-distributed-systems/consulting_01-fa277dfb3736a033cbfcf1ac931afb08.jpg" alt="Consultor铆a" />
    </div>

    </article>
    <div class="mb-2 mx-auto max-w-screen-lg text-center">
        <script src="https://giscus.app/client.js"
                data-repo="norberttech/norbert.tech"
                data-repo-id="MDEwOlJlcG9zaXRvcnkyMjQ0MDQwNDA="
                data-category="Comments"
                data-category-id="DIC_kwDODWAiSM4CionD"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="0"
                data-emit-metadata="0"
                data-input-position="bottom"
                data-theme="light"
                data-lang="en"
                crossorigin="anonymous"
                async>
        </script>
    </div>
    </main>

    <footer class="p-4 bg-sky-50 absolute bottom-0 w-full">
        <div class="mx-auto max-w-screen-2xl text-center">
            <a href="/">by @norbert_tech</a>
        </div>
    </footer>
</body>
</html>