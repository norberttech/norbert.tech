{% extends 'base.html.twig' %}

{% block language %}{{ post.language }}{% endblock %}

{% block header %}{% endblock %}

{% block content %}
    <div class="px-2 py-5 sm:px-4 md:px-8 lg:px-12 mx-auto max-w-4xl">
        <div class="mt-2 flex flex-wrap items-center gap-2">
            <a href="{{ path('blog') }}" class="inline-flex items-center px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded transition-colors font-medium">← Go Back</a>
            <span class="text-sm text-gray-600 ml-2">Available in:</span>

            {# Build array of all available languages including current #}
            {% set allLanguages = [post.language] %}
            {% for translationId in post.translationsIds %}
                {% set translatedPost = posts.get(translationId) %}
                {% set allLanguages = allLanguages|merge([translatedPost.language]) %}
            {% endfor %}

            {# Display all languages in consistent order #}
            {% for lang in ['en', 'pl', 'de', 'es', 'fr', 'it'] %}
                {% if lang in allLanguages %}
                    {% if lang == post.language %}
                        {# Current language - active state #}
                        <span class="inline-flex items-center px-2 py-1 text-sm bg-blue-600 text-white rounded font-medium"
                              title="{% if lang == 'en' %}English{% elseif lang == 'pl' %}Polish{% elseif lang == 'de' %}Deutsch{% elseif lang == 'es' %}Spanish{% elseif lang == 'fr' %}French{% elseif lang == 'it' %}Italian{% endif %}">
                            {% if lang == 'en' %}🇺🇸 EN{% elseif lang == 'pl' %}🇵🇱 PL{% elseif lang == 'de' %}🇩🇪 DE{% elseif lang == 'es' %}🇪🇸 ES{% elseif lang == 'fr' %}🇫🇷 FR{% elseif lang == 'it' %}🇮🇹 IT{% endif %}
                        </span>
                    {% else %}
                        {# Other languages - clickable #}
                        {% for translationId in post.translationsIds %}
                            {% set translatedPost = posts.get(translationId) %}
                            {% if translatedPost.language == lang %}
                                {% if lang == 'en' %}
                                    <a href="{{ path('blog_post', {date: translatedPost.date | date('Y-m-d'), slug: translatedPost.slug}) }}"
                                       class="inline-flex items-center px-2 py-1 text-sm bg-blue-100 hover:bg-blue-200 rounded transition-colors"
                                       title="English">🇺🇸 EN</a>
                                {% else %}
                                    <a href="{{ path('blog_post_language', {date: translatedPost.date | date('Y-m-d'), language: translatedPost.language, slug: translatedPost.slug}) }}"
                                       class="inline-flex items-center px-2 py-1 text-sm bg-blue-100 hover:bg-blue-200 rounded transition-colors"
                                       title="{% if lang == 'pl' %}Polish{% elseif lang == 'de' %}Deutsch{% elseif lang == 'es' %}Spanish{% elseif lang == 'fr' %}French{% elseif lang == 'it' %}Italian{% endif %}">
                                        {% if lang == 'pl' %}🇵🇱 PL{% elseif lang == 'de' %}🇩🇪 DE{% elseif lang == 'es' %}🇪🇸 ES{% elseif lang == 'fr' %}🇫🇷 FR{% elseif lang == 'it' %}🇮🇹 IT{% endif %}
                                    </a>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>

        {% if post.translated and post.language != 'en' %}
            <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-start">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h3 class="font-medium text-yellow-800">
                            Translation Notice
                        </h3>
                        <div class="mt-2 text-yellow-700">
                            <p>
                                This is an automatically translated version of that Article. Despite my best efforts, it might not be perfect.<br/>
                                Native speakers are welcome to
                                <a href="https://github.com/norberttech/norbert.tech/edit/main/templates/{{ template_folder }}/post.html.twig"
                                   class="underline hover:text-yellow-800" target="_blank" rel="noopener">open pull requests
                                </a> to correct anything that doesn't sound right.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
    <article class="blog-post">
        {{ block('article') }}
    </article>

    <div class="px-2 py-8 sm:px-4 md:px-8 lg:px-12 mx-auto max-w-4xl">
        <div class="border-t border-b border-gray-300 py-6">
            <h3 class="text-xl font-bold mb-4">About Author</h3>
            <div class="flex flex-col sm:flex-row gap-4">
                <div class="flex-shrink-0">
                    <img src="{{ asset('images/avatar.jpeg') }}" alt="Norbert Orzechowicz" class="w-24 h-24 rounded-full object-cover">
                </div>
                <div class="flex-1">
                    <h4 class="font-semibold text-lg mb-2">Norbert Orzechowicz</h4>
                    <p class="mb-2 text-gray-700">
                        Software architect with over 16 years of experience in building highly scalable transactional and analytical systems. I specialize in building bridges between business, development teams, systems architecture, and data infrastructure.
                    </p>
                    <p class="text-gray-700">
                        Creator of <a href="https://flow-php.com" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium">Flow</a>, the most advanced data processing framework for PHP. In my spare time, I maintain several open-source projects and enjoy automating and optimizing everything around me.
                    </p>
                    <div class="mt-3 flex flex-wrap gap-3">
                        <a href="https://flow-php.com" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            Flow PHP
                        </a>
                        <a href="https://twitter.com/norbert_tech" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm">
                            <img src="{{ asset('images/icons/brand/x.svg') }}" alt="Twitter" class="inline w-[16px] h-[16px]"> @norbert_tech
                        </a>
                        <a href="https://github.com/norberttech" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm">
                            <img src="{{ asset('images/icons/brand/github.svg') }}" alt="GitHub" class="inline w-[16px] h-[16px]"> norberttech
                        </a>
                        <a href="https://www.linkedin.com/in/norberttech/" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm">
                            <img src="{{ asset('images/icons/brand/linkedin.svg') }}" alt="LinkedIn" class="inline w-[16px] h-[16px]"> LinkedIn
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mb-2 mx-auto max-w-screen-lg text-center">
        <script src="https://giscus.app/client.js"
                data-repo="norberttech/norbert.tech"
                data-repo-id="MDEwOlJlcG9zaXRvcnkyMjQ0MDQwNDA="
                data-category="Comments"
                data-category-id="DIC_kwDODWAiSM4CionD"
                data-mapping="pathname"
                data-strict="0"
                data-reactions-enabled="0"
                data-emit-metadata="0"
                data-input-position="bottom"
                data-theme="light"
                data-lang="en"
                crossorigin="anonymous"
                async>
        </script>
    </div>
{% endblock %}